
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
      <meta name="description" content="Documentation for CALT library, a library for computational algebra using Transformers">
    
    
    
      <link rel="canonical" href="https://hiroshikera.github.io/calt/data_loader/">
    
    
      <link rel="prev" href="../dataset_generator/">
    
    
      <link rel="next" href="../trainer/">
    
    
    <link rel="icon" href="../assets/logo-light.png" sizes="any">
    <link rel="icon" href="../assets/logo-auto.svg" type="image/svg+xml">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">

    
      
        <title>Data Loader - CALT library</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-loader" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CALT library" class="md-header__button md-logo" aria-label="CALT library" data-md-component="logo">
      <!-- Logo -->
<img src="../assets/logo-light.svg" alt="logo" class="logo-light" />
<img src="../assets/logo-dark.svg" alt="logo" class="logo-dark" />
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CALT library
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Loader
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/HiroshiKERA/calt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href=".." class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CALT library" class="md-nav__button md-logo" aria-label="CALT library" data-md-component="logo">
      <!-- Logo -->
<img src="../assets/logo-light.svg" alt="logo" class="logo-light" />
<img src="../assets/logo-dark.svg" alt="logo" class="logo-dark" />
    </a>
    CALT library
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HiroshiKERA/calt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    CALT Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            CALT Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset Generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data Loader
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data Loader
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-loader" class="md-nav__link">
    <span class="md-ellipsis">
      Data Loader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Loader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entry-point" class="md-nav__link">
    <span class="md-ellipsis">
      Entry point
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.data_loader.load_data" class="md-nav__link">
    <span class="md-ellipsis">
      load_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataset-and-collator" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset and collator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataset" class="md-nav__link">
    <span class="md-ellipsis">
      StandardDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataset.load_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataCollator" class="md-nav__link">
    <span class="md-ellipsis">
      StandardDataCollator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataCollator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__call__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preprocessing-expression-internal-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessing (expression → internal tokens)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      PolynomialToInternalProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.encode" class="md-nav__link">
    <span class="md-ellipsis">
      encode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      IntegerToInternalProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.encode" class="md-nav__link">
    <span class="md-ellipsis">
      encode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="decode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      Tokenizer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.tokenizer.set_tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      set_tokenizer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.tokenizer.VocabConfig" class="md-nav__link">
    <span class="md-ellipsis">
      VocabConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VocabConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visualization-utilities-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Visualization utilities (optional)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.comparison_vis.display_with_diff" class="md-nav__link">
    <span class="md-ellipsis">
      display_with_diff
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.comparison_vis.load_eval_results" class="md-nav__link">
    <span class="md-ellipsis">
      load_eval_results
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.comparison_vis.parse_poly" class="md-nav__link">
    <span class="md-ellipsis">
      parse_poly
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trainer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-loader" class="md-nav__link">
    <span class="md-ellipsis">
      Data Loader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Loader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entry-point" class="md-nav__link">
    <span class="md-ellipsis">
      Entry point
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.data_loader.load_data" class="md-nav__link">
    <span class="md-ellipsis">
      load_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataset-and-collator" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset and collator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataset" class="md-nav__link">
    <span class="md-ellipsis">
      StandardDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataset.load_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataCollator" class="md-nav__link">
    <span class="md-ellipsis">
      StandardDataCollator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.data_collator.StandardDataCollator.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__call__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preprocessing-expression-internal-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessing (expression → internal tokens)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      PolynomialToInternalProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.encode" class="md-nav__link">
    <span class="md-ellipsis">
      encode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      IntegerToInternalProcessor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.encode" class="md-nav__link">
    <span class="md-ellipsis">
      encode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="decode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      Tokenizer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.tokenizer.set_tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      set_tokenizer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.tokenizer.VocabConfig" class="md-nav__link">
    <span class="md-ellipsis">
      VocabConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VocabConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visualization-utilities-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Visualization utilities (optional)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.comparison_vis.display_with_diff" class="md-nav__link">
    <span class="md-ellipsis">
      display_with_diff
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.comparison_vis.load_eval_results" class="md-nav__link">
    <span class="md-ellipsis">
      load_eval_results
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.data_loader.utils.comparison_vis.parse_poly" class="md-nav__link">
    <span class="md-ellipsis">
      parse_poly
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Data Loader</h1>

<h2 id="data-loader">Data Loader<a class="headerlink" href="#data-loader" title="Permanent link">&para;</a></h2>
<p>Utilities to prepare training/evaluation datasets, tokenizers, and data collators. They convert symbolic expressions (polynomials/integers) into internal token sequences and build batches suitable for training.</p>
<h3 id="entry-point">Entry point<a class="headerlink" href="#entry-point" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-function">



<a id="calt.data_loader.data_loader.load_data"></a>
    <div class="doc doc-contents first">

        <p>Create dataset, tokenizer and data-collator objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train_dataset_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file that stores the "training" samples.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_dataset_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file that stores the "evaluation" samples.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Finite-field identifier (e.g. <code>"Q"</code> for the rationals or <code>"Zp"</code>
for a prime field) used to generate the vocabulary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_variables</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of symbolic variables ((x_1, \dots, x_n)) that can
appear in a polynomial.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum total degree allowed for any monomial term.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_coeff</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum absolute value of the coefficients appearing in the data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_length</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hard upper bound on the token sequence length. Longer sequences will
be right-truncated. Defaults to 512.</p>
              </div>
            </td>
            <td>
                  <code>512</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>processor_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the processor to use for converting symbolic expressions into
internal token IDs. The default processor is <code>"polynomial"</code>, which
handles polynomial expressions. The alternative processor is
<code>"integer"</code>, which handles integer expressions. Defaults to
<code>"polynomial"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;polynomial&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vocab_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the vocabulary configuration file. If None, a default vocabulary
will be generated based on the field, max_degree, and max_coeff parameters.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_train_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of training samples to load. If None or -1, all available
training samples will be loaded. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_test_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of test samples to load. If None or -1, all available
test samples will be loaded. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="calt.data_loader.utils.data_collator.StandardDataset" href="#calt.data_loader.utils.data_collator.StandardDataset">StandardDataset</a>], <span title="transformers.PreTrainedTokenizerFast">PreTrainedTokenizerFast</span>, <a class="autorefs autorefs-internal" title="calt.data_loader.utils.data_collator.StandardDataCollator" href="#calt.data_loader.utils.data_collator.StandardDataCollator">StandardDataCollator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[dict[str, StandardDataset], StandardTokenizer, StandardDataCollator]:
1. <code>dataset</code> - a <code>dict</code> with <code>"train"</code> and <code>"test"</code> splits
   containing <code>StandardDataset</code> instances.
2. <code>tokenizer</code> - a <code>PreTrainedTokenizerFast</code> capable of encoding
   symbolic expressions into token IDs and vice versa.
3. <code>data_collator</code> - a callable that assembles batches and applies
   dynamic padding so they can be fed to a HuggingFace <code>Trainer</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/data_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span>
    <span class="n">train_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">test_dataset_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">num_variables</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">max_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">max_coeff</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">processor_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;polynomial&quot;</span><span class="p">,</span>
    <span class="n">vocab_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_train_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_test_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StandardDataset</span><span class="p">],</span> <span class="n">StandardTokenizer</span><span class="p">,</span> <span class="n">StandardDataCollator</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create dataset, tokenizer and data-collator objects.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_dataset_path (str):</span>
<span class="sd">            Path to the file that stores the &quot;training&quot; samples.</span>
<span class="sd">        test_dataset_path (str):</span>
<span class="sd">            Path to the file that stores the &quot;evaluation&quot; samples.</span>
<span class="sd">        field (str):</span>
<span class="sd">            Finite-field identifier (e.g. ``&quot;Q&quot;`` for the rationals or ``&quot;Zp&quot;``</span>
<span class="sd">            for a prime field) used to generate the vocabulary.</span>
<span class="sd">        num_variables (int):</span>
<span class="sd">            Maximum number of symbolic variables (\(x_1, \dots, x_n\)) that can</span>
<span class="sd">            appear in a polynomial.</span>
<span class="sd">        max_degree (int):</span>
<span class="sd">            Maximum total degree allowed for any monomial term.</span>
<span class="sd">        max_coeff (int):</span>
<span class="sd">            Maximum absolute value of the coefficients appearing in the data.</span>
<span class="sd">        max_length (int, optional):</span>
<span class="sd">            Hard upper bound on the token sequence length. Longer sequences will</span>
<span class="sd">            be right-truncated. Defaults to 512.</span>
<span class="sd">        processor_name (str, optional):</span>
<span class="sd">            Name of the processor to use for converting symbolic expressions into</span>
<span class="sd">            internal token IDs. The default processor is ``&quot;polynomial&quot;``, which</span>
<span class="sd">            handles polynomial expressions. The alternative processor is</span>
<span class="sd">            ``&quot;integer&quot;``, which handles integer expressions. Defaults to</span>
<span class="sd">            ``&quot;polynomial&quot;``.</span>
<span class="sd">        vocab_path (str | None, optional):</span>
<span class="sd">            Path to the vocabulary configuration file. If None, a default vocabulary</span>
<span class="sd">            will be generated based on the field, max_degree, and max_coeff parameters.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        num_train_samples (int | None, optional):</span>
<span class="sd">            Maximum number of training samples to load. If None or -1, all available</span>
<span class="sd">            training samples will be loaded. Defaults to None.</span>
<span class="sd">        num_test_samples (int | None, optional):</span>
<span class="sd">            Maximum number of test samples to load. If None or -1, all available</span>
<span class="sd">            test samples will be loaded. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[dict[str, StandardDataset], StandardTokenizer, StandardDataCollator]:</span>
<span class="sd">            1. ``dataset`` - a ``dict`` with ``&quot;train&quot;`` and ``&quot;test&quot;`` splits</span>
<span class="sd">               containing ``StandardDataset`` instances.</span>
<span class="sd">            2. ``tokenizer`` - a ``PreTrainedTokenizerFast`` capable of encoding</span>
<span class="sd">               symbolic expressions into token IDs and vice versa.</span>
<span class="sd">            3. ``data_collator`` - a callable that assembles batches and applies</span>
<span class="sd">               dynamic padding so they can be fed to a HuggingFace ``Trainer``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">processor_name</span> <span class="o">==</span> <span class="s2">&quot;polynomial&quot;</span><span class="p">:</span>
        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">PolynomialToInternalProcessor</span><span class="p">(</span>
            <span class="n">num_variables</span><span class="o">=</span><span class="n">num_variables</span><span class="p">,</span>
            <span class="n">max_degree</span><span class="o">=</span><span class="n">max_degree</span><span class="p">,</span>
            <span class="n">max_coeff</span><span class="o">=</span><span class="n">max_coeff</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">processor_name</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">:</span>
        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">IntegerToInternalProcessor</span><span class="p">(</span><span class="n">max_coeff</span><span class="o">=</span><span class="n">max_coeff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown processor: </span><span class="si">{</span><span class="n">processor_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">train_input_texts</span><span class="p">,</span> <span class="n">train_target_texts</span> <span class="o">=</span> <span class="n">_read_data_from_file</span><span class="p">(</span>
        <span class="n">train_dataset_path</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="n">num_train_samples</span>
    <span class="p">)</span>
    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">StandardDataset</span><span class="p">(</span>
        <span class="n">input_texts</span><span class="o">=</span><span class="n">train_input_texts</span><span class="p">,</span>
        <span class="n">target_texts</span><span class="o">=</span><span class="n">train_target_texts</span><span class="p">,</span>
        <span class="n">preprocessor</span><span class="o">=</span><span class="n">preprocessor</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">test_input_texts</span><span class="p">,</span> <span class="n">test_target_texts</span> <span class="o">=</span> <span class="n">_read_data_from_file</span><span class="p">(</span>
        <span class="n">test_dataset_path</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="n">num_test_samples</span>
    <span class="p">)</span>
    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">StandardDataset</span><span class="p">(</span>
        <span class="n">input_texts</span><span class="o">=</span><span class="n">test_input_texts</span><span class="p">,</span>
        <span class="n">target_texts</span><span class="o">=</span><span class="n">test_target_texts</span><span class="p">,</span>
        <span class="n">preprocessor</span><span class="o">=</span><span class="n">preprocessor</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">vocab_config</span><span class="p">:</span> <span class="n">VocabConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">vocab_path</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">vocab_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">vocab_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">set_tokenizer</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
        <span class="n">max_degree</span><span class="o">=</span><span class="n">max_degree</span><span class="p">,</span>
        <span class="n">max_coeff</span><span class="o">=</span><span class="n">max_coeff</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
        <span class="n">vocab_config</span><span class="o">=</span><span class="n">vocab_config</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">data_collator</span> <span class="o">=</span> <span class="n">StandardDataCollator</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">test_dataset</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">data_collator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="dataset-and-collator">Dataset and collator<a class="headerlink" href="#dataset-and-collator" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.data_loader.utils.data_collator.StandardDataset"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>








                  <details class="quote">
                    <summary>Source code in <code>src/calt/data_loader/utils/data_collator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_texts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">target_texts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">AbstractPreprocessor</span><span class="p">,</span>
    <span class="o">**</span><span class="n">extra_fields</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_texts</span> <span class="o">=</span> <span class="n">input_texts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_texts</span> <span class="o">=</span> <span class="n">target_texts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">preprocessor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extra_fields</span> <span class="o">=</span> <span class="n">extra_fields</span>

    <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_texts</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_texts</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_samples</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;input_texts and target_texts must have the same number of samples.&quot;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_samples</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Extra field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples, but </span><span class="si">{</span><span class="n">num_samples</span><span class="si">}</span><span class="s2"> were expected.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.data_loader.utils.data_collator.StandardDataset.load_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_file</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#calt.data_loader.utils.data_collator.StandardDataset.load_file" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_file</span><span class="p">(</span>
    <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">AbstractPreprocessor</span><span class="p">,</span>
    <span class="n">max_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StandardDataset</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load data from a file and create a <code>StandardDataset</code> instance.</p>
<p>This method maintains backward compatibility with the previous file-based initialization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the data file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>preprocessor</code>
            </td>
            <td>
                  <code><span title="calt.data_loader.utils.preprocessor.AbstractPreprocessor">AbstractPreprocessor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessor instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of samples to load.
Use -1 or None to load all samples. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StandardDataset</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="calt.data_loader.utils.data_collator.StandardDataset" href="#calt.data_loader.utils.data_collator.StandardDataset">StandardDataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loaded dataset instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/data_collator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_file</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">AbstractPreprocessor</span><span class="p">,</span>
    <span class="n">max_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StandardDataset&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data from a file and create a ``StandardDataset`` instance.</span>

<span class="sd">    This method maintains backward compatibility with the previous file-based initialization.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_path (str): Path to the data file.</span>
<span class="sd">        preprocessor (AbstractPreprocessor): Preprocessor instance.</span>
<span class="sd">        max_samples (int | None, optional): Maximum number of samples to load.</span>
<span class="sd">            Use -1 or None to load all samples. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        StandardDataset: Loaded dataset instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_texts</span><span class="p">,</span> <span class="n">target_texts</span> <span class="o">=</span> <span class="n">_read_data_from_file</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">max_samples</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">input_texts</span><span class="o">=</span><span class="n">input_texts</span><span class="p">,</span>
        <span class="n">target_texts</span><span class="o">=</span><span class="n">target_texts</span><span class="p">,</span>
        <span class="n">preprocessor</span><span class="o">=</span><span class="n">preprocessor</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.data_loader.utils.data_collator.StandardDataset.__getitem__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__getitem__</span>


<a href="#calt.data_loader.utils.data_collator.StandardDataset.__getitem__" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get dataset item and convert to internal representation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the item to retrieve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, str]: A mapping with keys <code>"input"</code> and <code>"target"</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/data_collator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dataset item and convert to internal representation.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx (int): Index of the item to retrieve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str]: A mapping with keys ``&quot;input&quot;`` and ``&quot;target&quot;``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_texts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_texts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">src</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">tgt</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="calt.data_loader.utils.data_collator.StandardDataCollator"></a>
    <div class="doc doc-contents first">








                  <details class="quote">
                    <summary>Source code in <code>src/calt/data_loader/utils/data_collator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">:</span> <span class="n">Tokenizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.data_loader.utils.data_collator.StandardDataCollator.__call__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__call__</span>


<a href="#calt.data_loader.utils.data_collator.StandardDataCollator.__call__" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__call__</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Collate a batch of data samples.</p>
<p>If a tokenizer is provided, it tokenizes <code>input</code> and <code>target</code> attributes.
Other attributes starting with <code>target_</code> are prefixed with <code>decoder_</code> and padded.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mini-batch samples.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, torch.Tensor | list[str]]: Batched tensors and/or lists.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/data_collator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collate a batch of data samples.</span>

<span class="sd">    If a tokenizer is provided, it tokenizes ``input`` and ``target`` attributes.</span>
<span class="sd">    Other attributes starting with ``target_`` are prefixed with ``decoder_`` and padded.</span>

<span class="sd">    Args:</span>
<span class="sd">        batch (list[dict[str, Any]]): Mini-batch samples.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, torch.Tensor | list[str]]: Batched tensors and/or lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get the attributes from the first item in the batch.</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If no tokenizer is provided, return the batch as is.</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">attribute_batch</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
            <span class="n">batch_dict</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute_batch</span>

        <span class="k">return</span> <span class="n">batch_dict</span>

    <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">attribute_batch</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="c1"># Tokenize the input sequences.</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
                <span class="n">attribute_batch</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;longest&quot;</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
            <span class="p">)</span>
            <span class="n">batch_dict</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span>
            <span class="n">batch_dict</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span>
            <span class="c1"># Tokenize the target sequences.</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
                <span class="n">attribute_batch</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;longest&quot;</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Prepare decoder input ids (remove the last token, usually EOS).</span>
            <span class="n">batch_dict</span><span class="p">[</span><span class="s2">&quot;decoder_input_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][</span>
                <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span>
            <span class="p">]</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="c1"># Prepare decoder attention mask accordingly.</span>
            <span class="n">batch_dict</span><span class="p">[</span><span class="s2">&quot;decoder_attention_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">][</span>
                <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span>
            <span class="p">]</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>

            <span class="c1"># Prepare labels for the loss calculation (shift by one, usually remove BOS).</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="n">label_attention_mask</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">targets</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="c1"># Set padding tokens in labels to -100 to be ignored by the loss function.</span>
            <span class="n">labels</span><span class="p">[</span><span class="o">~</span><span class="n">label_attention_mask</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
            <span class="n">batch_dict</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For other attributes, if they start with &#39;target_&#39;,</span>
            <span class="c1"># prefix them with &#39;decoder_&#39; (e.g., &#39;target_aux&#39; becomes &#39;decoder_aux&#39;).</span>
            <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;target_&quot;</span><span class="p">):</span>
                <span class="n">attribute_key</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;decoder_&quot;</span> <span class="o">+</span> <span class="n">attribute</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
                <span class="p">)</span>  <span class="c1">#  Corrected key for batch_dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attribute_key</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">attribute</span>  <span class="c1"># Use original attribute name if no prefix</span>
                <span class="p">)</span>
            <span class="c1"># Pad the sequences for these attributes.</span>
            <span class="n">batch_dict</span><span class="p">[</span><span class="n">attribute_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pad_sequences</span><span class="p">(</span>
                <span class="n">attribute_batch</span><span class="p">,</span> <span class="n">padding_value</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">batch_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="preprocessing-expression-internal-tokens">Preprocessing (expression → internal tokens)<a class="headerlink" href="#preprocessing-expression-internal-tokens" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="calt.data_loader.utils.preprocessor.AbstractPreprocessor">AbstractPreprocessor</span></code></p>


        <p>Convert SageMath-style expressions to/from internal token representation.</p>
<p>Example (to_internal):
    "2<em>x1^2</em>x0 + 5*x0 - 3" -&gt; "C2 E1 E2 C5 E1 E0 C-3 E0 E0" (for <code>num_vars=2</code>)</p>
<p>Example (to_original):
    "C2 E2 E1 C5 E1 E0 C-3 E0 E0" -&gt; "2<em>x0^2</em>x1 + 5*x0 - 3"</p>


<details class="the-internal-representation-uses" open>
  <summary>The internal representation uses</summary>
  <ul>
<li><code>C{n}</code> tokens for coefficients (e.g., <code>C2</code>, <code>C-3</code>)</li>
<li><code>E{n}</code> tokens for exponents (e.g., <code>E1</code>, <code>E2</code>, <code>E0</code>)</li>
</ul>
</details>        <p>Each term is represented as a coefficient token followed by exponent tokens for each variable.</p>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/data_loader/utils/preprocessor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_variables</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize preprocessor parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_variables (int): Number of variables in the polynomial (e.g., x0, x1, ...).</span>
<span class="sd">        max_degree (int): Maximum degree of the polynomial.</span>
<span class="sd">        max_coeff (int): Maximum coefficient value in the polynomial.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_variables</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_variables must be positive&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_degree must be non-negative&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_coeff</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_coeff must be positive&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span> <span class="o">=</span> <span class="n">num_variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_degree</span> <span class="o">=</span> <span class="n">max_degree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_coeff</span> <span class="o">=</span> <span class="n">max_coeff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">var_name_to_index</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;x</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_variables</span><span class="p">)}</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.encode" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">encode</span>


<a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.encode" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">encode</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Process a symbolic text into internal token representation.</p>
<p>If the text contains the '|' separator character, each part is processed
separately and joined with '[SEP]' token.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input symbolic text to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String in the internal token representation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a symbolic text into internal token representation.</span>

<span class="sd">    If the text contains the &#39;|&#39; separator character, each part is processed</span>
<span class="sd">    separately and joined with &#39;[SEP]&#39; token.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): Input symbolic text to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: String in the internal token representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If text contains &#39;|&#39;, process each part separately and join with [SEP]</span>
    <span class="k">if</span> <span class="s2">&quot;|&quot;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
        <span class="n">internals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_poly_to_encode</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">]</span>
        <span class="n">processed_string</span> <span class="o">=</span> <span class="s2">&quot; [SEP] &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">internals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">processed_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_to_encode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">processed_string</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.decode" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">decode</span>


<a href="#calt.data_loader.utils.preprocessor.PolynomialToInternalProcessor.decode" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">decode</span><span class="p">(</span><span class="n">tokens</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert an internal token string back to a symbolic polynomial expression.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert an internal token string back to a symbolic polynomial expression.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;[SEP]&quot;</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[SEP]&quot;</span><span class="p">)</span>
        <span class="n">original_parts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_to_poly</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_parts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_to_poly</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="calt.data_loader.utils.preprocessor.IntegerToInternalProcessor"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="calt.data_loader.utils.preprocessor.AbstractPreprocessor">AbstractPreprocessor</span></code></p>


        <p>Convert an integer string to/from internal token representation.</p>
<p>Input format examples (to_internal):
    - "12345"
    - "123|45|678"
Output format examples (from_internal):
    - "C1 C2 C3 C4 C5"
    - "C1 C2 C3 [SEP] C4 C5 [SEP] C6 C7 C8"</p>
<p>The internal representation uses <code>C{n}</code> tokens for digits.
Parts separated by '|' are converted individually and joined by <code>[SEP]</code>.
Note: <code>num_variables</code>, <code>max_degree</code>, <code>max_coeff</code> are inherited but not directly used.</p>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_coeff</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum digit value (typically 9). Passed to superclass but primarily used for validation context.</p>
              </div>
            </td>
            <td>
                  <code>9</code>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/data_loader/utils/preprocessor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the processor.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_coeff (int): The maximum digit value (typically 9). Passed to superclass but primarily used for validation context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use dummy values for num_variables and max_degree as they are not relevant</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">num_variables</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_degree</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_coeff</span><span class="o">=</span><span class="n">max_coeff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.encode" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">encode</span>


<a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.encode" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">encode</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Process an integer string into internal token representation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input string representing one or more integers separated by '|'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal token representation (e.g., "C1 C2 [SEP] C3 C4"), or "[ERROR_FORMAT]" if any part is not a valid integer string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an integer string into internal token representation.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): Input string representing one or more integers separated by &#39;|&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Internal token representation (e.g., &quot;C1 C2 [SEP] C3 C4&quot;), or &quot;[ERROR_FORMAT]&quot; if any part is not a valid integer string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;|&quot;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
        <span class="n">tokenized_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_to_tokens</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tokens</span> <span class="o">==</span> <span class="s2">&quot;[ERROR_FORMAT]&quot;</span><span class="p">:</span>
                <span class="c1"># If any part fails, return error for the whole input</span>
                <span class="k">return</span> <span class="s2">&quot;[ERROR_FORMAT]&quot;</span>
            <span class="n">tokenized_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="c1"># Join the tokenized parts with [SEP]</span>
        <span class="k">return</span> <span class="s2">&quot; [SEP] &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokenized_parts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If no separator, process the whole string</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_to_tokens</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.decode" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">decode</span>


<a href="#calt.data_loader.utils.preprocessor.IntegerToInternalProcessor.decode" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">decode</span><span class="p">(</span><span class="n">tokens</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert an internal token representation back to an integer string.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert an internal token representation back to an integer string.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;[SEP]&quot;</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[SEP]&quot;</span><span class="p">)</span>
        <span class="c1"># Process each part and join with &#39;|&#39;</span>
        <span class="n">number_parts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokens_to_number</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">number_parts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Process the whole string if no separator</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens_to_number</span><span class="p">(</span><span class="n">tokens</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="tokenizer">Tokenizer<a class="headerlink" href="#tokenizer" title="Permanent link">&para;</a></h3>
<p>Build or load a tokenizer for polynomial expressions and configure the vocabulary.
</p>


<div class="doc doc-object doc-function">



<a id="calt.data_loader.utils.tokenizer.set_tokenizer"></a>
    <div class="doc doc-contents first">

        <p>Create or load a tokenizer for polynomial expressions.</p>
<p>If a <code>vocab_config</code> is provided, it builds a tokenizer from the config.
Otherwise, it creates a new tokenizer based on the provided parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field specification ("QQ"/"ZZ" for rational/integer, or "GF<p>"
for finite field). Used if <code>vocab_config</code> is not provided.</p>
              </div>
            </td>
            <td>
                  <code>&#39;GF&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_coeff</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum absolute value for coefficients. Used if
<code>vocab_config</code> is not provided.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum degree for any variable. Used if <code>vocab_config</code> is
not provided.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_length</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum sequence length the tokenizer will process.</p>
              </div>
            </td>
            <td>
                  <code>512</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vocab_config</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="calt.data_loader.utils.tokenizer.VocabConfig" href="#calt.data_loader.utils.tokenizer.VocabConfig">VocabConfig</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary with "vocab" and "special_vocab".</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PreTrainedTokenizerFast</code></td>            <td>
                  <code><span title="transformers.PreTrainedTokenizerFast">PreTrainedTokenizerFast</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A pre-configured HuggingFace tokenizer for polynomial expressions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_tokenizer</span><span class="p">(</span>
    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GF&quot;</span><span class="p">,</span>
    <span class="n">max_coeff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">max_degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">vocab_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VocabConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreTrainedTokenizerFast</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create or load a tokenizer for polynomial expressions.</span>

<span class="sd">    If a ``vocab_config`` is provided, it builds a tokenizer from the config.</span>
<span class="sd">    Otherwise, it creates a new tokenizer based on the provided parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        field (str): Field specification (&quot;QQ&quot;/&quot;ZZ&quot; for rational/integer, or &quot;GF&lt;p&gt;&quot;</span>
<span class="sd">            for finite field). Used if ``vocab_config`` is not provided.</span>
<span class="sd">        max_coeff (int): Maximum absolute value for coefficients. Used if</span>
<span class="sd">            ``vocab_config`` is not provided.</span>
<span class="sd">        max_degree (int): Maximum degree for any variable. Used if ``vocab_config`` is</span>
<span class="sd">            not provided.</span>
<span class="sd">        max_length (int): Maximum sequence length the tokenizer will process.</span>
<span class="sd">        vocab_config (Optional[VocabConfig]): Optional dictionary with &quot;vocab&quot; and &quot;special_vocab&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        PreTrainedTokenizerFast: A pre-configured HuggingFace tokenizer for polynomial expressions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">vocab_config</span><span class="p">:</span>
        <span class="n">vocab_list</span> <span class="o">=</span> <span class="n">vocab_config</span><span class="p">[</span><span class="s2">&quot;vocab&quot;</span><span class="p">]</span>
        <span class="n">special_token_map</span> <span class="o">=</span> <span class="n">vocab_config</span><span class="p">[</span><span class="s2">&quot;special_vocab&quot;</span><span class="p">]</span>
        <span class="n">special_tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">special_token_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Create tokenizer from scratch</span>
        <span class="n">special_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[PAD]&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;s&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;/s&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;[CLS]&quot;</span><span class="p">]</span>
        <span class="n">special_token_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;pad_token&quot;</span><span class="p">,</span> <span class="s2">&quot;bos_token&quot;</span><span class="p">,</span> <span class="s2">&quot;eos_token&quot;</span><span class="p">,</span> <span class="s2">&quot;cls_token&quot;</span><span class="p">],</span>
                <span class="n">special_tokens</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">CONSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[C]&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="s2">&quot;ZZ&quot;</span><span class="p">:</span>
            <span class="n">CONSTS</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">max_coeff</span><span class="p">,</span> <span class="n">max_coeff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GF&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid field specification for GF(p): </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">CONSTS</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unknown field: </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">ECONSTS</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;E</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">vocab_list</span> <span class="o">=</span> <span class="n">CONSTS</span> <span class="o">+</span> <span class="n">ECONSTS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;[SEP]&quot;</span><span class="p">]</span>

    <span class="n">vocab</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">))))</span>

    <span class="n">tok</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">WordLevel</span><span class="p">(</span><span class="n">vocab</span><span class="p">))</span>
    <span class="n">tok</span><span class="o">.</span><span class="n">pre_tokenizer</span> <span class="o">=</span> <span class="n">CharDelimiterSplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">tok</span><span class="o">.</span><span class="n">add_special_tokens</span><span class="p">(</span><span class="n">special_tokens</span><span class="p">)</span>
    <span class="n">tok</span><span class="o">.</span><span class="n">enable_padding</span><span class="p">()</span>
    <span class="n">tok</span><span class="o">.</span><span class="n">no_truncation</span><span class="p">()</span>

    <span class="n">bos_token</span> <span class="o">=</span> <span class="n">special_token_map</span><span class="p">[</span><span class="s2">&quot;bos_token&quot;</span><span class="p">]</span>
    <span class="n">eos_token</span> <span class="o">=</span> <span class="n">special_token_map</span><span class="p">[</span><span class="s2">&quot;eos_token&quot;</span><span class="p">]</span>
    <span class="n">tok</span><span class="o">.</span><span class="n">post_processor</span> <span class="o">=</span> <span class="n">TemplateProcessing</span><span class="p">(</span>
        <span class="n">single</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bos_token</span><span class="si">}</span><span class="s2"> $A </span><span class="si">{</span><span class="n">eos_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">special_tokens</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="n">bos_token</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">token_to_id</span><span class="p">(</span><span class="n">bos_token</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">eos_token</span><span class="p">,</span> <span class="n">tok</span><span class="o">.</span><span class="n">token_to_id</span><span class="p">(</span><span class="n">eos_token</span><span class="p">)),</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">PreTrainedTokenizerFast</span><span class="p">(</span>
        <span class="n">tokenizer_object</span><span class="o">=</span><span class="n">tok</span><span class="p">,</span>
        <span class="n">model_max_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
        <span class="o">**</span><span class="n">special_token_map</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tokenizer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-class">



<a id="calt.data_loader.utils.tokenizer.VocabConfig"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>











  <div class="doc doc-children">











  </div>

    </div>

</div><h3 id="visualization-utilities-optional">Visualization utilities (optional)<a class="headerlink" href="#visualization-utilities-optional" title="Permanent link">&para;</a></h3>
<p>Quickly render visual diffs between predictions and references.
</p>


<div class="doc doc-object doc-function">



<a id="calt.data_loader.utils.comparison_vis.display_with_diff"></a>
    <div class="doc doc-contents first">

        <p>Render "gold" vs. "pred" with strikethrough on mistakes in "pred".</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gold</code>
            </td>
            <td>
                  <code><span title="sympy.Expr">Expr</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ground-truth expression. If a string, it will be parsed as a token
sequence (e.g., "C1 E1 E1 C-3 E0 E7") via <code>parse_poly</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pred</code>
            </td>
            <td>
                  <code><span title="sympy.Expr">Expr</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model-predicted expression. If a string, it will be parsed as a token
sequence via <code>parse_poly</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var_order</code>
            </td>
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="sympy.Symbol">Symbol</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable ordering (important for &gt;2 variables). Inferred if None. Also
passed to <code>parse_poly</code> if inputs are strings. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/comparison_vis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display_with_diff</span><span class="p">(</span>
    <span class="n">gold</span><span class="p">:</span> <span class="n">Expr</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pred</span><span class="p">:</span> <span class="n">Expr</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">var_order</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Symbol</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render &quot;gold&quot; vs. &quot;pred&quot; with strikethrough on mistakes in &quot;pred&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        gold (sympy.Expr | str):</span>
<span class="sd">            Ground-truth expression. If a string, it will be parsed as a token</span>
<span class="sd">            sequence (e.g., &quot;C1 E1 E1 C-3 E0 E7&quot;) via ``parse_poly``.</span>
<span class="sd">        pred (sympy.Expr | str):</span>
<span class="sd">            Model-predicted expression. If a string, it will be parsed as a token</span>
<span class="sd">            sequence via ``parse_poly``.</span>
<span class="sd">        var_order (Sequence[sympy.Symbol] | None, optional):</span>
<span class="sd">            Variable ordering (important for &gt;2 variables). Inferred if None. Also</span>
<span class="sd">            passed to ``parse_poly`` if inputs are strings. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># --- input conversion ------------------------------------------------- #</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gold</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">gold</span> <span class="o">=</span> <span class="n">parse_poly</span><span class="p">(</span><span class="n">gold</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_order</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">parse_poly</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_order</span><span class="p">)</span>

    <span class="c1"># --- normalize -------------------------------------------------------- #</span>
    <span class="k">if</span> <span class="n">var_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">var_order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">gold</span><span class="o">.</span><span class="n">free_symbols</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
    <span class="n">gold_poly</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">gold</span><span class="o">.</span><span class="n">expand</span><span class="p">(),</span> <span class="o">*</span><span class="n">var_order</span><span class="p">)</span>
    <span class="n">pred_poly</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">expand</span><span class="p">(),</span> <span class="o">*</span><span class="n">var_order</span><span class="p">)</span>

    <span class="n">gdict</span> <span class="o">=</span> <span class="n">_poly_to_dict</span><span class="p">(</span><span class="n">gold_poly</span><span class="p">)</span>
    <span class="n">pdict</span> <span class="o">=</span> <span class="n">_poly_to_dict</span><span class="p">(</span><span class="n">pred_poly</span><span class="p">)</span>

    <span class="c1"># --- diff detection --------------------------------------------------- #</span>
    <span class="n">diff</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">exps</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">gdict</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">pdict</span><span class="p">):</span>
        <span class="n">gcoeff</span> <span class="o">=</span> <span class="n">gdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">exps</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pcoeff</span> <span class="o">=</span> <span class="n">pdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">exps</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pcoeff</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">gcoeff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>  <span class="c1"># missing term (not highlighted)</span>
        <span class="k">if</span> <span class="n">gcoeff</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pcoeff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">diff</span><span class="p">[</span><span class="n">exps</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;extra&quot;</span>
        <span class="k">elif</span> <span class="n">gcoeff</span> <span class="o">!=</span> <span class="n">pcoeff</span><span class="p">:</span>
            <span class="n">diff</span><span class="p">[</span><span class="n">exps</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;coeff_wrong&quot;</span>

    <span class="c1"># --- render ----------------------------------------------------------- #</span>
    <span class="n">gold_tex</span> <span class="o">=</span> <span class="n">latex</span><span class="p">(</span><span class="n">gold</span><span class="o">.</span><span class="n">expand</span><span class="p">())</span>
    <span class="n">pred_tex</span> <span class="o">=</span> <span class="n">_build_poly_latex</span><span class="p">(</span><span class="n">pdict</span><span class="p">,</span> <span class="n">var_order</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span>
        <span class="n">Math</span><span class="p">(</span>
<span class="w">            </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;\begin{aligned}</span>
<span class="sd">        \text{Ground truth\,:}\; &amp; {}&quot;&quot;&quot;</span>
            <span class="o">+</span> <span class="n">gold_tex</span>
            <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;\\</span>
<span class="s2">        \text{Prediction\,:}\;   &amp; </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="o">+</span> <span class="n">pred_tex</span>
            <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        \end</span><span class="si">{aligned}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="calt.data_loader.utils.comparison_vis.load_eval_results"></a>
    <div class="doc doc-contents first">

        <p>Load evaluation results from a JSON file.</p>
<p>The JSON file should contain a list of objects with "generated" and "reference" keys.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSON file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="str">str</span>], <span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[list[str], list[str]]: A tuple containing two lists:
- List of generated texts.
- List of reference texts.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/comparison_vis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_eval_results</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load evaluation results from a JSON file.</span>

<span class="sd">    The JSON file should contain a list of objects with &quot;generated&quot; and &quot;reference&quot; keys.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): Path to the JSON file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[list[str], list[str]]: A tuple containing two lists:</span>
<span class="sd">            - List of generated texts.</span>
<span class="sd">            - List of reference texts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">generated_texts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reference_texts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">generated_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;generated&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">reference_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">generated_texts</span><span class="p">,</span> <span class="n">reference_texts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="calt.data_loader.utils.comparison_vis.parse_poly"></a>
    <div class="doc doc-contents first">

        <p>Convert a math expression string or token sequence to a SymPy polynomial.</p>
<p>This function handles:
1. Standard mathematical notation (e.g., "4<em>x0 + 4</em>x1").
2. SageMath-style power notation (e.g., "3<em>x0^2 + 3</em>x0").
3. Internal token format (e.g., "C4 E1 E0 C4 E0 E1").</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mathematical expression or token sequence to parse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var_names</code>
            </td>
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="str">str</span> | <span title="sympy.Symbol">Symbol</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable names. Primarily used for the token sequence format to ensure
the correct number of variables. For expression strings, variables are
inferred, but providing them can ensure they are treated as symbols.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="sympy.Expr">Expr</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sympy.Expr: A SymPy expression for the polynomial.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/data_loader/utils/comparison_vis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_poly</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">var_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Symbol</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a math expression string or token sequence to a SymPy polynomial.</span>

<span class="sd">    This function handles:</span>
<span class="sd">    1. Standard mathematical notation (e.g., &quot;4*x0 + 4*x1&quot;).</span>
<span class="sd">    2. SageMath-style power notation (e.g., &quot;3*x0^2 + 3*x0&quot;).</span>
<span class="sd">    3. Internal token format (e.g., &quot;C4 E1 E0 C4 E0 E1&quot;).</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>
<span class="sd">            The mathematical expression or token sequence to parse.</span>
<span class="sd">        var_names (Sequence[str | sympy.Symbol] | None, optional):</span>
<span class="sd">            Variable names. Primarily used for the token sequence format to ensure</span>
<span class="sd">            the correct number of variables. For expression strings, variables are</span>
<span class="sd">            inferred, but providing them can ensure they are treated as symbols.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sympy.Expr: A SymPy expression for the polynomial.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Heuristic: if the text starts with a &#39;C&#39; token, attempt to parse it</span>
    <span class="c1"># using the token-based parser first.</span>
    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_parse_poly_from_tokens</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">var_names</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="c1"># Fallback to standard expression parsing if token parsing fails.</span>
            <span class="c1"># This allows parsing expressions that happen to start with &#39;C&#39;</span>
            <span class="c1"># (e.g., if &#39;C&#39; is a variable name).</span>
            <span class="k">pass</span>

    <span class="c1"># Standard expression parsing</span>
    <span class="c1"># Replace SageMath-style power operator &#39;^&#39; with SymPy&#39;s &#39;**&#39;</span>
    <span class="n">text_sympy</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">)</span>

    <span class="c1"># Prepare a local dictionary of symbols if var_names are provided</span>
    <span class="n">local_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">var_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">):</span>
            <span class="n">symbols_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symbols_map</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">):</span> <span class="n">Symbol</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">}</span>
        <span class="n">local_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">symbols_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parse_expr</span><span class="p">(</span><span class="n">text_sympy</span><span class="p">,</span> <span class="n">local_dict</span><span class="o">=</span><span class="n">local_dict</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>