
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
      <meta name="description" content="Documentation for CALT library, a library for computational algebra using Transformers">
    
    
    
      <link rel="canonical" href="https://hiroshikera.github.io/calt/dataset_generator/">
    
    
      <link rel="prev" href="..">
    
    
      <link rel="next" href="../data_loader/">
    
    
    <link rel="icon" href="../assets/logo-light.png" sizes="any">
    <link rel="icon" href="../assets/logo-auto.svg" type="image/svg+xml">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">

    
      
        <title>Dataset Generator - CALT library</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dataset-generator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CALT library" class="md-header__button md-logo" aria-label="CALT library" data-md-component="logo">
      <!-- Logo -->
<img src="../assets/logo-light.svg" alt="logo" class="logo-light" />
<img src="../assets/logo-dark.svg" alt="logo" class="logo-dark" />
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CALT library
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dataset Generator
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/HiroshiKERA/calt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href=".." class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CALT library" class="md-nav__button md-logo" aria-label="CALT library" data-md-component="logo">
      <!-- Logo -->
<img src="../assets/logo-light.svg" alt="logo" class="logo-light" />
<img src="../assets/logo-dark.svg" alt="logo" class="logo-dark" />
    </a>
    CALT library
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HiroshiKERA/calt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    CALT Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            CALT Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Dataset Generator
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Dataset Generator
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#common-sagemath-backend-example" class="md-nav__link">
    <span class="md-ellipsis">
      Common (SageMath backend example)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common (SageMath backend example)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generation-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Generation flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.dataset_generator.DatasetGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetGenerator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.dataset_generator.DatasetGenerator.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-and-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Writing and statistics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetWriter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient batch processing with file handle management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--or-use-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Or use context manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits" class="md-nav__link">
    <span class="md-ellipsis">
      Support for various dataset splits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close_all" class="md-nav__link">
    <span class="md-ellipsis">
      close_all
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_batch" class="md-nav__link">
    <span class="md-ellipsis">
      save_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_final_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      save_final_statistics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset_jsonl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryEfficientStatisticsCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="md-nav__link">
    <span class="md-ellipsis">
      update_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      get_overall_statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_overall_statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler" class="md-nav__link">
    <span class="md-ellipsis">
      PolynomialSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_field
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_ring" class="md-nav__link">
    <span class="md-ellipsis">
      get_ring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-sympy-backend-example" class="md-nav__link">
    <span class="md-ellipsis">
      Common (SymPy backend example)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common (SymPy backend example)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generation-flow_1" class="md-nav__link">
    <span class="md-ellipsis">
      Generation flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.dataset_generator.DatasetGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetGenerator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.dataset_generator.DatasetGenerator.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-and-statistics_1" class="md-nav__link">
    <span class="md-ellipsis">
      Writing and statistics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetWriter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient batch processing with file handle management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--or-use-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Or use context manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits" class="md-nav__link">
    <span class="md-ellipsis">
      Support for various dataset splits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close_all" class="md-nav__link">
    <span class="md-ellipsis">
      close_all
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_batch" class="md-nav__link">
    <span class="md-ellipsis">
      save_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_final_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      save_final_statistics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset_jsonl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryEfficientStatisticsCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="md-nav__link">
    <span class="md-ellipsis">
      update_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      get_overall_statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_overall_statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler" class="md-nav__link">
    <span class="md-ellipsis">
      PolynomialSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_field
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_ring" class="md-nav__link">
    <span class="md-ellipsis">
      get_ring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.total_degree" class="md-nav__link">
    <span class="md-ellipsis">
      total_degree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler" class="md-nav__link">
    <span class="md-ellipsis">
      SinglePolynomialSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_coeff" class="md-nav__link">
    <span class="md-ellipsis">
      random_coeff
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_element" class="md-nav__link">
    <span class="md-ellipsis">
      random_element
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Loader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trainer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#common-sagemath-backend-example" class="md-nav__link">
    <span class="md-ellipsis">
      Common (SageMath backend example)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common (SageMath backend example)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generation-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Generation flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.dataset_generator.DatasetGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetGenerator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.dataset_generator.DatasetGenerator.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-and-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Writing and statistics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetWriter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient batch processing with file handle management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--or-use-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Or use context manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits" class="md-nav__link">
    <span class="md-ellipsis">
      Support for various dataset splits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close_all" class="md-nav__link">
    <span class="md-ellipsis">
      close_all
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_batch" class="md-nav__link">
    <span class="md-ellipsis">
      save_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_final_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      save_final_statistics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset_jsonl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryEfficientStatisticsCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="md-nav__link">
    <span class="md-ellipsis">
      update_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      get_overall_statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_overall_statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler" class="md-nav__link">
    <span class="md-ellipsis">
      PolynomialSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_field
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_ring" class="md-nav__link">
    <span class="md-ellipsis">
      get_ring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-sympy-backend-example" class="md-nav__link">
    <span class="md-ellipsis">
      Common (SymPy backend example)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common (SymPy backend example)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generation-flow_1" class="md-nav__link">
    <span class="md-ellipsis">
      Generation flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.dataset_generator.DatasetGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetGenerator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.dataset_generator.DatasetGenerator.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-and-statistics_1" class="md-nav__link">
    <span class="md-ellipsis">
      Writing and statistics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetWriter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient batch processing with file handle management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--or-use-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Or use context manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits" class="md-nav__link">
    <span class="md-ellipsis">
      Support for various dataset splits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.open" class="md-nav__link">
    <span class="md-ellipsis">
      open
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close_all" class="md-nav__link">
    <span class="md-ellipsis">
      close_all
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      __enter__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      __exit__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_batch" class="md-nav__link">
    <span class="md-ellipsis">
      save_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_final_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      save_final_statistics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="md-nav__link">
    <span class="md-ellipsis">
      load_dataset_jsonl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryEfficientStatisticsCalculator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="md-nav__link">
    <span class="md-ellipsis">
      update_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      get_overall_statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_overall_statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sampling_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler" class="md-nav__link">
    <span class="md-ellipsis">
      PolynomialSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_field
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_ring" class="md-nav__link">
    <span class="md-ellipsis">
      get_ring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.total_degree" class="md-nav__link">
    <span class="md-ellipsis">
      total_degree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler" class="md-nav__link">
    <span class="md-ellipsis">
      SinglePolynomialSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_coeff" class="md-nav__link">
    <span class="md-ellipsis">
      random_coeff
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_element" class="md-nav__link">
    <span class="md-ellipsis">
      random_element
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="dataset-generator">Dataset Generator<a class="headerlink" href="#dataset-generator" title="Permanent link">&para;</a></h1>
<p>A unified interface with SageMath and SymPy backends for large-scale dataset generation. It produces paired problems and solutions, supports batch writing, and computes incremental statistics.</p>
<h2 id="common-sagemath-backend-example">Common (SageMath backend example)<a class="headerlink" href="#common-sagemath-backend-example" title="Permanent link">&para;</a></h2>
<h3 id="generation-flow">Generation flow<a class="headerlink" href="#generation-flow" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sagemath.dataset_generator.DatasetGenerator"></a>
    <div class="doc doc-contents first">


        <p>Base class for problem generators</p>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>backend</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Backend for parallel processing</p>
              </div>
            </td>
            <td>
                  <code>&#39;multiprocessing&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parallel jobs (-1 for all cores)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to display progress information</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_seed</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Root seed for reproducibility</p>
              </div>
            </td>
            <td>
                  <code>42</code>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sagemath/dataset_generator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multiprocessing&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">root_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize problem generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        backend: Backend for parallel processing</span>
<span class="sd">        n_jobs: Number of parallel jobs (-1 for all cores)</span>
<span class="sd">        verbose: Whether to display progress information</span>
<span class="sd">        root_seed: Root seed for reproducibility</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_jobs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root_seed</span> <span class="o">=</span> <span class="n">root_seed</span>

    <span class="c1"># Configure logging only once at initialization</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="c1"># Configure joblib logging to show progress but not overwhelm</span>
    <span class="c1"># Only set if not already configured</span>
    <span class="n">joblib_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;joblib&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">joblib_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">:</span>
        <span class="n">joblib_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="n">parallel_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;joblib.Parallel&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parallel_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">:</span>
        <span class="n">parallel_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.dataset_generator.DatasetGenerator.run" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run</span>


<a href="#calt.dataset_generator.sagemath.dataset_generator.DatasetGenerator.run" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run</span><span class="p">(</span>
    <span class="n">dataset_sizes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">problem_generator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">statistics_calculator</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dataset_writer</span><span class="p">:</span> <span class="n">DatasetWriter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate multiple datasets using parallel processing with batch writing.</p>
<p>This is the main entry point for dataset generation. It supports generating
multiple datasets (train/test) simultaneously or separately, with efficient
memory management through batch processing and parallel execution.</p>
<p>Key features:
- Parallel processing using joblib for high performance
- Batch-based memory management to handle large datasets
- Incremental statistics calculation to avoid memory issues
- Reproducible generation with unique seeds for each sample
- Support for nested data structures (up to 2 levels)
- Multiple output formats (pickle, text, JSON) via DatasetWriter</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_sizes</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping dataset names to number of samples.
          Any string can be used as dataset name (e.g., "train", "test", "validation").
          Duplicate names are not allowed.
          Example: {"train": 100000, "test": 1000} or {"train": 100000, "validation": 5000}</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>problem_generator</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that generates (problem, solution) pair given a seed.
             Must accept a single integer seed parameter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>statistics_calculator</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional function to calculate sample-specific statistics.
                 Must accept (problem, solution) and return dict or None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_writer</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter" href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter">DatasetWriter</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DatasetWriter object for saving datasets to files.
          If None, a new DatasetWriter will be created using save_dir, save_text, and save_json parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to process in each batch. Larger batches
       use more memory but may be more efficient for I/O operations.</p>
              </div>
            </td>
            <td>
                  <code>100000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for saving datasets. Used only if dataset_writer is None.
     If None, uses current working directory.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_text</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save raw text files. Used only if dataset_writer is None.
      Text files use "#" as separator between problem and solution.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_json</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save JSON Lines files. Used only if dataset_writer is None.
      JSON Lines files preserve the original nested structure format.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If dataset_sizes is invalid or problem_generator is None</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If parallel processing fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Each sample gets a unique seed for reproducibility</li>
<li>Progress is logged if verbose=True (set in <strong>init</strong>)</li>
<li>Memory usage scales with batch_size, not total dataset size</li>
<li>Statistics are calculated incrementally to handle large datasets</li>
<li>If dataset_writer is provided, save_dir, save_text, and save_json parameters are ignored</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define problem generator function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">polynomial_generator</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="gp">... </span>    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># Generate random polynomial problem</span>
<span class="gp">... </span>    <span class="n">problem</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))]</span>
<span class="gp">... </span>    <span class="n">solution</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">problem</span><span class="p">,</span> <span class="n">solution</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize dataset generator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span> <span class="o">=</span> <span class="n">DatasetGenerator</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Method 1: Automatic DatasetWriter creation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;validation&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Method 2: Manual DatasetWriter creation (for advanced use cases)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">calt.dataset_generator.sagemath</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetWriter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span> <span class="o">=</span> <span class="n">DatasetWriter</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span> <span class="n">save_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dataset_writer</span><span class="o">=</span><span class="n">writer</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Method 3: Generate datasets separately (if needed)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;validation&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/dataset_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataset_sizes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">problem_generator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">statistics_calculator</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dataset_writer</span><span class="p">:</span> <span class="n">DatasetWriter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate multiple datasets using parallel processing with batch writing.</span>

<span class="sd">    This is the main entry point for dataset generation. It supports generating</span>
<span class="sd">    multiple datasets (train/test) simultaneously or separately, with efficient</span>
<span class="sd">    memory management through batch processing and parallel execution.</span>

<span class="sd">    Key features:</span>
<span class="sd">    - Parallel processing using joblib for high performance</span>
<span class="sd">    - Batch-based memory management to handle large datasets</span>
<span class="sd">    - Incremental statistics calculation to avoid memory issues</span>
<span class="sd">    - Reproducible generation with unique seeds for each sample</span>
<span class="sd">    - Support for nested data structures (up to 2 levels)</span>
<span class="sd">    - Multiple output formats (pickle, text, JSON) via DatasetWriter</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_sizes: Dictionary mapping dataset names to number of samples.</span>
<span class="sd">                      Any string can be used as dataset name (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;).</span>
<span class="sd">                      Duplicate names are not allowed.</span>
<span class="sd">                      Example: {&quot;train&quot;: 100000, &quot;test&quot;: 1000} or {&quot;train&quot;: 100000, &quot;validation&quot;: 5000}</span>
<span class="sd">        problem_generator: Function that generates (problem, solution) pair given a seed.</span>
<span class="sd">                         Must accept a single integer seed parameter.</span>
<span class="sd">        statistics_calculator: Optional function to calculate sample-specific statistics.</span>
<span class="sd">                             Must accept (problem, solution) and return dict or None.</span>
<span class="sd">        dataset_writer: DatasetWriter object for saving datasets to files.</span>
<span class="sd">                      If None, a new DatasetWriter will be created using save_dir, save_text, and save_json parameters.</span>
<span class="sd">        batch_size: Number of samples to process in each batch. Larger batches</span>
<span class="sd">                   use more memory but may be more efficient for I/O operations.</span>
<span class="sd">        save_dir: Base directory for saving datasets. Used only if dataset_writer is None.</span>
<span class="sd">                 If None, uses current working directory.</span>
<span class="sd">        save_text: Whether to save raw text files. Used only if dataset_writer is None.</span>
<span class="sd">                  Text files use &quot;#&quot; as separator between problem and solution.</span>
<span class="sd">        save_json: Whether to save JSON Lines files. Used only if dataset_writer is None.</span>
<span class="sd">                  JSON Lines files preserve the original nested structure format.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If dataset_sizes is invalid or problem_generator is None</span>
<span class="sd">        Exception: If parallel processing fails</span>

<span class="sd">    Note:</span>
<span class="sd">        - Each sample gets a unique seed for reproducibility</span>
<span class="sd">        - Progress is logged if verbose=True (set in __init__)</span>
<span class="sd">        - Memory usage scales with batch_size, not total dataset size</span>
<span class="sd">        - Statistics are calculated incrementally to handle large datasets</span>
<span class="sd">        - If dataset_writer is provided, save_dir, save_text, and save_json parameters are ignored</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Define problem generator function</span>
<span class="sd">        &gt;&gt;&gt; def polynomial_generator(seed):</span>
<span class="sd">        ...     import random</span>
<span class="sd">        ...     random.seed(seed)</span>
<span class="sd">        ...     # Generate random polynomial problem</span>
<span class="sd">        ...     problem = [random.randint(1, 1000) for _ in range(random.randint(1, 10))]</span>
<span class="sd">        ...     solution = sum(problem)</span>
<span class="sd">        ...     return problem, solution</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Initialize dataset generator</span>
<span class="sd">        &gt;&gt;&gt; generator = DatasetGenerator(n_jobs=-1, verbose=True)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Method 1: Automatic DatasetWriter creation</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;train&quot;: 10000, &quot;test&quot;: 1000, &quot;validation&quot;: 500},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     save_dir=&quot;./datasets&quot;,</span>
<span class="sd">        ...     save_text=True,</span>
<span class="sd">        ...     save_json=True,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Method 2: Manual DatasetWriter creation (for advanced use cases)</span>
<span class="sd">        &gt;&gt;&gt; from calt.dataset_generator.sagemath import DatasetWriter</span>
<span class="sd">        &gt;&gt;&gt; writer = DatasetWriter(save_dir=&quot;./datasets&quot;, save_text=True, save_json=True)</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;train&quot;: 10000, &quot;test&quot;: 1000},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     dataset_writer=writer,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Method 3: Generate datasets separately (if needed)</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;train&quot;: 10000},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     save_dir=&quot;./datasets&quot;,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;test&quot;: 1000, &quot;validation&quot;: 500},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     save_dir=&quot;./datasets&quot;,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create DatasetWriter if not provided</span>
    <span class="k">if</span> <span class="n">dataset_writer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dataset_writer</span> <span class="o">=</span> <span class="n">DatasetWriter</span><span class="p">(</span>
            <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span>
            <span class="n">save_text</span><span class="o">=</span><span class="n">save_text</span><span class="p">,</span>
            <span class="n">save_json</span><span class="o">=</span><span class="n">save_json</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;save_dir: </span><span class="si">{</span><span class="n">dataset_writer</span><span class="o">.</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text output: </span><span class="si">{</span><span class="n">save_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON output: </span><span class="si">{</span><span class="n">save_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Prepare common arguments</span>
    <span class="n">common_args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;problem_generator&quot;</span><span class="p">:</span> <span class="n">problem_generator</span><span class="p">,</span>
        <span class="s2">&quot;statistics_calculator&quot;</span><span class="p">:</span> <span class="n">statistics_calculator</span><span class="p">,</span>
        <span class="s2">&quot;dataset_writer&quot;</span><span class="p">:</span> <span class="n">dataset_writer</span><span class="p">,</span>
        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">batch_size</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Validate dataset_sizes</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dataset_sizes must be a dictionary&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dataset_sizes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dataset_sizes cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">problem_generator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;problem_generator must be provided&quot;</span><span class="p">)</span>

    <span class="c1"># Check for duplicate dataset names</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duplicate dataset names are not allowed&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">num_samples</span> <span class="ow">in</span> <span class="n">dataset_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">num_samples</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Number of samples must be a positive integer, got </span><span class="si">{</span><span class="n">num_samples</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Log overall generation start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;=========================== Dataset generation ===========================</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Starting dataset generation for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="p">)</span><span class="si">}</span><span class="s2"> dataset(s)&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset sizes: </span><span class="si">{</span><span class="n">dataset_sizes</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate each dataset</span>
    <span class="k">for</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">num_samples</span> <span class="ow">in</span> <span class="n">dataset_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_dataset</span><span class="p">(</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span> <span class="o">**</span><span class="n">common_args</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All datasets generated successfully!&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;==========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="writing-and-statistics">Writing and statistics<a class="headerlink" href="#writing-and-statistics" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter"></a>
    <div class="doc doc-contents first">


        <p>Dataset writer for saving problem-solution pairs in multiple formats.</p>
<p>This class handles saving datasets with nested structure support up to 2 levels.
It can save data in pickle (binary), raw text, and JSON Lines formats.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.INNER_SEP">INNER_SEP</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator for single-level lists (" | ")</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.OUTER_SEP">OUTER_SEP</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator for nested lists (" || ")</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_dir">save_dir</span></code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for saving datasets</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_text">save_text</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save raw text files</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_json">save_json</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save JSON Lines files</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter._file_handles">_file_handles</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store open file handles</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for saving datasets. If None, uses current working directory.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_text</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save raw text files. Text files use "#" as separator
      between problem and solution, with nested structures joined by separators.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_json</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save JSON Lines files. JSON Lines files preserve the original
      nested structure format, with one sample per line.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Pickle files are always saved as they are the primary format for data loading.
Text and JSON Lines files are optional and controlled by save_text and save_json flags.</p>
</details>

<details class="usage" open>
  <summary>Usage</summary>
  <h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management">Efficient batch processing with file handle management<a class="headerlink" href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management" title="Permanent link">&para;</a></h2>
<p>writer = DatasetWriter(save_dir="./datasets")
writer.open("train")  # Open file handles once
try:
    for batch_idx, samples in enumerate(batches):
        writer.save_batch(samples, tag="train", batch_idx=batch_idx)
finally:
    writer.close("train")  # Close file handles</p>
<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--or-use-context-manager">Or use context manager<a class="headerlink" href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--or-use-context-manager" title="Permanent link">&para;</a></h2>
<p>with DatasetWriter(save_dir="./datasets") as writer:
    writer.open("train")
    for batch_idx, samples in enumerate(batches):
        writer.save_batch(samples, tag="train", batch_idx=batch_idx)
    writer.close("train")</p>
<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits">Support for various dataset splits<a class="headerlink" href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits" title="Permanent link">&para;</a></h2>
<p>writer.open("validation")  # Validation set
writer.open("dev")         # Development set
writer.open("eval")        # Evaluation set</p>
</details>






                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize dataset writer.</span>

<span class="sd">    Args:</span>
<span class="sd">        save_dir: Base directory for saving datasets. If None, uses current working directory.</span>
<span class="sd">        save_text: Whether to save raw text files. Text files use &quot;#&quot; as separator</span>
<span class="sd">                  between problem and solution, with nested structures joined by separators.</span>
<span class="sd">        save_json: Whether to save JSON Lines files. JSON Lines files preserve the original</span>
<span class="sd">                  nested structure format, with one sample per line.</span>

<span class="sd">    Note:</span>
<span class="sd">        Pickle files are always saved as they are the primary format for data loading.</span>
<span class="sd">        Text and JSON Lines files are optional and controlled by save_text and save_json flags.</span>

<span class="sd">    Usage:</span>
<span class="sd">        # Efficient batch processing with file handle management</span>
<span class="sd">        writer = DatasetWriter(save_dir=&quot;./datasets&quot;)</span>
<span class="sd">        writer.open(&quot;train&quot;)  # Open file handles once</span>
<span class="sd">        try:</span>
<span class="sd">            for batch_idx, samples in enumerate(batches):</span>
<span class="sd">                writer.save_batch(samples, tag=&quot;train&quot;, batch_idx=batch_idx)</span>
<span class="sd">        finally:</span>
<span class="sd">            writer.close(&quot;train&quot;)  # Close file handles</span>

<span class="sd">        # Or use context manager</span>
<span class="sd">        with DatasetWriter(save_dir=&quot;./datasets&quot;) as writer:</span>
<span class="sd">            writer.open(&quot;train&quot;)</span>
<span class="sd">            for batch_idx, samples in enumerate(batches):</span>
<span class="sd">                writer.save_batch(samples, tag=&quot;train&quot;, batch_idx=batch_idx)</span>
<span class="sd">            writer.close(&quot;train&quot;)</span>

<span class="sd">        # Support for various dataset splits</span>
<span class="sd">        writer.open(&quot;validation&quot;)  # Validation set</span>
<span class="sd">        writer.open(&quot;dev&quot;)         # Development set</span>
<span class="sd">        writer.open(&quot;eval&quot;)        # Evaluation set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">save_dir</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_text</span> <span class="o">=</span> <span class="n">save_text</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_json</span> <span class="o">=</span> <span class="n">save_json</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {tag: {file_type: file_handle}}</span>
    <span class="n">TimedeltaDumper</span><span class="o">.</span><span class="n">add_representer</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">timedelta_representer</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.open" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">open</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.open" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">open</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Open file handles for the specified tag.</p>
<p>This method should be called before starting batch processing to avoid
repeated file open/close operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open file handles for the specified tag.</span>

<span class="sd">    This method should be called before starting batch processing to avoid</span>
<span class="sd">    repeated file open/close operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File handles for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; are already open&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">dataset_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_dir</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Create batch directory for pickle files</span>
    <span class="n">batch_dir</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_batches&quot;</span>
    <span class="n">batch_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Open text file if enabled</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_text</span><span class="p">:</span>
        <span class="n">raw_path</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_raw.txt&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">raw_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

    <span class="c1"># Open JSON Lines file if enabled</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_json</span><span class="p">:</span>
        <span class="n">json_path</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_data.jsonl&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">close</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">close</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Close file handles for the specified tag.</p>
<p>This method should be called after finishing batch processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Close file handles for the specified tag.</span>

<span class="sd">    This method should be called after finishing batch processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No open file handles found for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Combine batch files into final pickle file</span>
    <span class="k">if</span> <span class="s2">&quot;batch_dir&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_combine_batch_files</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="c1"># Close all open file handles</span>
    <span class="k">for</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">file_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>  <span class="c1"># Only close actual file handles</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error closing </span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2"> file for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close_all" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">close_all</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.close_all" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">close_all</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Close all open file handles.</p>
<p>This method should be called when the writer is no longer needed.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Close all open file handles.</span>

<span class="sd">    This method should be called when the writer is no longer needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__enter__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__enter__</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__enter__" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__enter__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager entry.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager entry.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__exit__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__exit__</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.__exit__" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager exit - close all files.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager exit - close all files.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">close_all</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_batch" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">save_batch</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_batch" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">save_batch</span><span class="p">(</span>
    <span class="n">samples</span><span class="p">:</span> <span class="n">StringSampleList</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Save a batch of samples to files in multiple formats.</p>
<p>This method saves samples in three formats:
1. Pickle (.pkl) - Binary format, always saved, used for loading
2. Raw text (.txt) - Human-readable format with separators (if save_text=True)
3. JSON Lines (.jsonl) - Structured format preserving nested structure (if save_json=True)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>samples</code>
            </td>
            <td>
                  <code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.StringSampleList">StringSampleList</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (problem, solution) pairs in string format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                  <code>&#39;train&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch index for incremental saving. Use 0 for first batch,
      subsequent batches will append to existing files.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid or samples contain invalid nested structures</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple string samples (single problem-solution pairs)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span> <span class="o">=</span> <span class="n">DatasetWriter</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span> <span class="n">save_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;x^2 + 2*x + 1&quot;</span><span class="p">,</span> <span class="s2">&quot;(x + 1)^2&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;2*x^3 - 3*x^2&quot;</span><span class="p">,</span> <span class="s2">&quot;x^2*(2*x - 3)&quot;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Creates: train_data.pkl, train_raw.txt, train_data.jsonl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 1 level nested structure samples (multiple problems/solutions)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">([</span><span class="s2">&quot;x + y&quot;</span><span class="p">,</span> <span class="s2">&quot;x - y&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;2*x&quot;</span><span class="p">,</span> <span class="s2">&quot;2*y&quot;</span><span class="p">]),</span>
<span class="gp">... </span>    <span class="p">([</span><span class="s2">&quot;x^2 + y^2&quot;</span><span class="p">,</span> <span class="s2">&quot;x^2 - y^2&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;2*x^2&quot;</span><span class="p">,</span> <span class="s2">&quot;2*y^2&quot;</span><span class="p">]),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Text output: &quot;x + y | x - y # 2*x | 2*y&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 2 level nested structure samples (complex nested problems)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]]),</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;x + y&quot;</span><span class="p">,</span> <span class="s2">&quot;x - y&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;z + w&quot;</span><span class="p">,</span> <span class="s2">&quot;z - w&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;x + y&quot;</span><span class="p">,</span> <span class="s2">&quot;z + w&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;x - y&quot;</span><span class="p">,</span> <span class="s2">&quot;z - w&quot;</span><span class="p">]]),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Text output: &quot;x | y || z | w # x | z || y | w&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Append more samples to existing dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">more_samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">]]),</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">]]),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Appends to existing files instead of overwriting</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">more_samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">:</span> <span class="n">StringSampleList</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
    <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a batch of samples to files in multiple formats.</span>

<span class="sd">    This method saves samples in three formats:</span>
<span class="sd">    1. Pickle (.pkl) - Binary format, always saved, used for loading</span>
<span class="sd">    2. Raw text (.txt) - Human-readable format with separators (if save_text=True)</span>
<span class="sd">    3. JSON Lines (.jsonl) - Structured format preserving nested structure (if save_json=True)</span>

<span class="sd">    Args:</span>
<span class="sd">        samples: List of (problem, solution) pairs in string format</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>
<span class="sd">        batch_idx: Batch index for incremental saving. Use 0 for first batch,</span>
<span class="sd">                  subsequent batches will append to existing files.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid or samples contain invalid nested structures</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Simple string samples (single problem-solution pairs)</span>
<span class="sd">        &gt;&gt;&gt; writer = DatasetWriter(save_dir=&quot;./datasets&quot;, save_text=True, save_json=True)</span>
<span class="sd">        &gt;&gt;&gt; samples = [</span>
<span class="sd">        ...     (&quot;x^2 + 2*x + 1&quot;, &quot;(x + 1)^2&quot;),</span>
<span class="sd">        ...     (&quot;2*x^3 - 3*x^2&quot;, &quot;x^2*(2*x - 3)&quot;),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Creates: train_data.pkl, train_raw.txt, train_data.jsonl</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(samples, tag=&quot;train&quot;, batch_idx=0)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # 1 level nested structure samples (multiple problems/solutions)</span>
<span class="sd">        &gt;&gt;&gt; samples = [</span>
<span class="sd">        ...     ([&quot;x + y&quot;, &quot;x - y&quot;], [&quot;2*x&quot;, &quot;2*y&quot;]),</span>
<span class="sd">        ...     ([&quot;x^2 + y^2&quot;, &quot;x^2 - y^2&quot;], [&quot;2*x^2&quot;, &quot;2*y^2&quot;]),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Text output: &quot;x + y | x - y # 2*x | 2*y&quot;</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(samples, tag=&quot;test&quot;, batch_idx=0)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # 2 level nested structure samples (complex nested problems)</span>
<span class="sd">        &gt;&gt;&gt; samples = [</span>
<span class="sd">        ...     ([[&quot;x&quot;, &quot;y&quot;], [&quot;z&quot;, &quot;w&quot;]], [[&quot;x&quot;, &quot;z&quot;], [&quot;y&quot;, &quot;w&quot;]]),</span>
<span class="sd">        ...     ([[&quot;x + y&quot;, &quot;x - y&quot;], [&quot;z + w&quot;, &quot;z - w&quot;]], [[&quot;x + y&quot;, &quot;z + w&quot;], [&quot;x - y&quot;, &quot;z - w&quot;]]),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Text output: &quot;x | y || z | w # x | z || y | w&quot;</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(samples, tag=&quot;test&quot;, batch_idx=0)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Append more samples to existing dataset</span>
<span class="sd">        &gt;&gt;&gt; more_samples = [</span>
<span class="sd">        ...     ([[&quot;a&quot;, &quot;b&quot;], [&quot;c&quot;, &quot;d&quot;]], [[&quot;a&quot;, &quot;c&quot;], [&quot;b&quot;, &quot;d&quot;]]),</span>
<span class="sd">        ...     ([[&quot;e&quot;, &quot;f&quot;], [&quot;g&quot;, &quot;h&quot;]], [[&quot;e&quot;, &quot;g&quot;], [&quot;f&quot;, &quot;h&quot;]]),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Appends to existing files instead of overwriting</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(more_samples, tag=&quot;train&quot;, batch_idx=1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="c1"># Validate samples</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">samples</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Empty samples list provided - no files will be created&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Check if file handles are open for this tag</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span>
        <span class="c1"># Fallback to old method if file handles are not open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_batch_legacy</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Save binary data (pickle format) - save batch individually</span>
    <span class="n">batch_file</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_dir&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;batch_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s1">&#39;batch_count&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">06d</span><span class="si">}</span><span class="s2">.pkl&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">batch_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Save raw text data (optional)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_text</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
            <span class="n">formatted_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_sample_strings</span><span class="p">(</span><span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted_line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="c1"># Save JSON Lines data (optional)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_json</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_json_data</span><span class="p">(</span><span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span><span class="p">)</span>
            <span class="n">json_line</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">json_line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_final_statistics" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">save_final_statistics</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.save_final_statistics" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">save_final_statistics</span><span class="p">(</span><span class="n">statistics</span><span class="p">:</span> <span class="n">StatisticsDict</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;train&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Save final overall statistics to YAML file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>statistics</code>
            </td>
            <td>
                  <code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.StatisticsDict">StatisticsDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing dataset statistics</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                  <code>&#39;train&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Statistics are saved in YAML format for human readability.
The file is named "{tag}_stats.yaml" in the dataset directory.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_final_statistics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">statistics</span><span class="p">:</span> <span class="n">StatisticsDict</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save final overall statistics to YAML file.</span>

<span class="sd">    Args:</span>
<span class="sd">        statistics: Dictionary containing dataset statistics</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>

<span class="sd">    Note:</span>
<span class="sd">        Statistics are saved in YAML format for human readability.</span>
<span class="sd">        The file is named &quot;{tag}_stats.yaml&quot; in the dataset directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">dataset_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_dir</span><span class="p">()</span>

    <span class="n">stats_path</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_stats.yaml&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stats_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="n">statistics</span><span class="p">,</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="n">Dumper</span><span class="o">=</span><span class="n">TimedeltaDumper</span><span class="p">,</span>
            <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_dataset</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_dataset</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load dataset from pickle file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.StringSampleList">StringSampleList</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (problem, solution) pairs in string format</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the pickle file doesn't exist</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">problem</span><span class="p">,</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem: </span><span class="si">{</span><span class="n">problem</span><span class="si">}</span><span class="s2">, Solution: </span><span class="si">{</span><span class="n">solution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load dataset from pickle file.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of (problem, solution) pairs in string format</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">        FileNotFoundError: If the pickle file doesn&#39;t exist</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; samples = writer.load_dataset(&quot;train&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Loaded {len(samples)} samples&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for problem, solution in samples[:3]:</span>
<span class="sd">        ...     print(f&quot;Problem: {problem}, Solution: {solution}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">pickle_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_data.pkl&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pickle_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset file not found: </span><span class="si">{</span><span class="n">pickle_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_dataset_jsonl</span>


<a href="#calt.dataset_generator.sagemath.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_dataset_jsonl</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load dataset from JSON Lines file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="calt.dataset_generator.sagemath.utils.dataset_writer.StringSampleList">StringSampleList</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (problem, solution) pairs in string format</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the JSON Lines file doesn't exist</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">load_dataset_jsonl</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">problem</span><span class="p">,</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem: </span><span class="si">{</span><span class="n">problem</span><span class="si">}</span><span class="s2">, Solution: </span><span class="si">{</span><span class="n">solution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_dataset_jsonl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load dataset from JSON Lines file.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of (problem, solution) pairs in string format</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">        FileNotFoundError: If the JSON Lines file doesn&#39;t exist</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; samples = writer.load_dataset_jsonl(&quot;train&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Loaded {len(samples)} samples&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for problem, solution in samples[:3]:</span>
<span class="sd">        ...     print(f&quot;Problem: {problem}, Solution: {solution}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">jsonl_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_data.jsonl&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">jsonl_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON Lines file not found: </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Skip empty lines</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">problem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;problem&quot;</span><span class="p">]</span>
                <span class="n">solution</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;solution&quot;</span><span class="p">]</span>
                <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">problem</span><span class="p">,</span> <span class="n">solution</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

    <span class="k">return</span> <span class="n">samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator"></a>
    <div class="doc doc-contents first">


        <p>Memory-efficient statistics calculator that uses incremental computation.</p>
<p>This calculator avoids storing all data in memory by computing statistics
incrementally as batches are processed using Welford's online algorithm
for numerical stability and memory efficiency. All standard deviations
are calculated as population standard deviations.</p>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/statistics_calculator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize incremental sample statistics calculator.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">runtime_stats</span> <span class="o">=</span> <span class="n">IncrementalStatistics</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store aggregated sample statistics by category</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_batch</span>


<a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">update_batch</span><span class="p">(</span>
    <span class="n">runtimes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">batch_sample_stats</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Update statistics with a batch of results using Welford's online algorithm.</p>
<p>This method processes each sample individually, updating both runtime
statistics and sample-specific statistics incrementally for better
control and efficiency.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>runtimes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of runtime values for each sample in the batch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_sample_stats</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="int">int</span> | <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of sample statistics dictionaries for the current batch.
               Each dictionary has the structure:
               {"category1": {"metric1": value1, ...},
                "category2": {"metric1": value1, ...}}
               Example:
               [{"problem": {"total_degree": 2, "num_polynomials": 3},
                 "solution": {"total_degree": 3, "num_polynomials": 3}},
                {"problem": {"total_degree": 5, "num_polynomials": 4},
                 "solution": {"total_degree": 8, "num_polynomials": 4}},
                ...]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/statistics_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">runtimes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">batch_sample_stats</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update statistics with a batch of results using Welford&#39;s online algorithm.</span>

<span class="sd">    This method processes each sample individually, updating both runtime</span>
<span class="sd">    statistics and sample-specific statistics incrementally for better</span>
<span class="sd">    control and efficiency.</span>

<span class="sd">    Args:</span>
<span class="sd">        runtimes: List of runtime values for each sample in the batch</span>
<span class="sd">        batch_sample_stats: List of sample statistics dictionaries for the current batch.</span>
<span class="sd">                           Each dictionary has the structure:</span>
<span class="sd">                           {&quot;category1&quot;: {&quot;metric1&quot;: value1, ...},</span>
<span class="sd">                            &quot;category2&quot;: {&quot;metric1&quot;: value1, ...}}</span>
<span class="sd">                           Example:</span>
<span class="sd">                           [{&quot;problem&quot;: {&quot;total_degree&quot;: 2, &quot;num_polynomials&quot;: 3},</span>
<span class="sd">                             &quot;solution&quot;: {&quot;total_degree&quot;: 3, &quot;num_polynomials&quot;: 3}},</span>
<span class="sd">                            {&quot;problem&quot;: {&quot;total_degree&quot;: 5, &quot;num_polynomials&quot;: 4},</span>
<span class="sd">                             &quot;solution&quot;: {&quot;total_degree&quot;: 8, &quot;num_polynomials&quot;: 4}},</span>
<span class="sd">                            ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Update runtime statistics</span>
    <span class="k">for</span> <span class="n">runtime</span> <span class="ow">in</span> <span class="n">runtimes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

    <span class="c1"># Update sample statistics</span>
    <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">batch_sample_stats</span><span class="p">:</span>
        <span class="c1"># Update each numeric sample statistic incrementally</span>
        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">category_stats</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_stats</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># Handle nested structure like {&quot;problem&quot;: {...}, &quot;solution&quot;: {...}}</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">category_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">stat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">stat_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">IncrementalStatistics</span><span class="p">()</span>
                            <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">stat_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_stats</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="c1"># Handle flat structure</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">IncrementalStatistics</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">category_stats</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_overall_statistics</span>


<a href="#calt.dataset_generator.sagemath.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_overall_statistics</span><span class="p">(</span><span class="n">total_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get overall statistics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>total_time</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total processing time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of samples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing overall statistics with the structure:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{
"total_time": float,
"num_samples": int,
"samples_per_second": float,
"generation_time": {"mean": float, "std": float, "min": float, "max": float},
"problem_stats": {"metric1": {"mean": float, "std": float, "min": float, "max": float}, ...},
"solution_stats": {"metric1": {"mean": float, "std": float, "min": float, "max": float}, ...}</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>}</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/statistics_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_overall_statistics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">total_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get overall statistics.</span>

<span class="sd">    Args:</span>
<span class="sd">        total_time: Total processing time</span>
<span class="sd">        num_samples: Total number of samples</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing overall statistics with the structure:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;total_time&quot;: float,</span>
<span class="sd">            &quot;num_samples&quot;: int,</span>
<span class="sd">            &quot;samples_per_second&quot;: float,</span>
<span class="sd">            &quot;generation_time&quot;: {&quot;mean&quot;: float, &quot;std&quot;: float, &quot;min&quot;: float, &quot;max&quot;: float},</span>
<span class="sd">            &quot;problem_stats&quot;: {&quot;metric1&quot;: {&quot;mean&quot;: float, &quot;std&quot;: float, &quot;min&quot;: float, &quot;max&quot;: float}, ...},</span>
<span class="sd">            &quot;solution_stats&quot;: {&quot;metric1&quot;: {&quot;mean&quot;: float, &quot;std&quot;: float, &quot;min&quot;: float, &quot;max&quot;: float}, ...}</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">runtime_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_stats</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>

    <span class="n">overall_stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="n">total_time</span><span class="p">,</span>
        <span class="s2">&quot;num_samples&quot;</span><span class="p">:</span> <span class="n">num_samples</span><span class="p">,</span>
        <span class="s2">&quot;samples_per_second&quot;</span><span class="p">:</span> <span class="n">num_samples</span> <span class="o">/</span> <span class="n">total_time</span> <span class="k">if</span> <span class="n">total_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;generation_time&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">],</span>
            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># Add sample statistics by category</span>
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">category_stats</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_stats</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Handle nested structure like {&quot;problem&quot;: {...}, &quot;solution&quot;: {...}}</span>
            <span class="n">overall_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">stat_name</span><span class="p">:</span> <span class="n">stat_calc</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">stat_calc</span> <span class="ow">in</span> <span class="n">category_stats</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Handle flat structure</span>
            <span class="n">overall_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">category_stats</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">overall_stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="sampling">Sampling<a class="headerlink" href="#sampling" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler"></a>
    <div class="doc doc-contents first">


        <p>Generator for random polynomials with specific constraints</p>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbols</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbols of polynomial ring (required if ring is None)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_str</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field of polynomial ring (required if ring is None)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="sage.all.TermOrder">TermOrder</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order of polynomial ring (required if ring is None)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ring</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PolynomialRing object (alternative to symbols/field_str/order)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_num_terms</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of terms in polynomial. If None, all possible terms are allowed.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum degree of polynomial</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum degree of polynomial</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_coeff</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum coefficient value (used for RR and ZZ)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bound</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum absolute value of coefficients (used for QQ)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>degree_sampling</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to sample degree ('uniform' or 'fixed')</p>
              </div>
            </td>
            <td>
                  <code>&#39;uniform&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>term_sampling</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to sample number of terms ('uniform' or 'fixed')</p>
              </div>
            </td>
            <td>
                  <code>&#39;uniform&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strictly_conditioned</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to strictly enforce conditions</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nonzero_instance</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to enforce non-zero instance</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nonzero_coeff</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to exclude zero coefficients during coefficient generation</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_attempts</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of attempts to generate a polynomial satisfying conditions</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/polynomial_sampler.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">TermOrder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ring</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_num_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">min_degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">degree_sampling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>  <span class="c1"># &#39;uniform&#39; or &#39;fixed&#39;</span>
    <span class="n">term_sampling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>  <span class="c1"># &#39;uniform&#39; or &#39;fixed&#39;</span>
    <span class="n">max_coeff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Used for RR and ZZ</span>
    <span class="n">num_bound</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Used for QQ</span>
    <span class="n">strictly_conditioned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">nonzero_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">nonzero_coeff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Whether to exclude zero coefficients</span>
    <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize polynomial sampler</span>

<span class="sd">    Args:</span>
<span class="sd">        symbols: Symbols of polynomial ring (required if ring is None)</span>
<span class="sd">        field_str: Field of polynomial ring (required if ring is None)</span>
<span class="sd">        order: Order of polynomial ring (required if ring is None)</span>
<span class="sd">        ring: PolynomialRing object (alternative to symbols/field_str/order)</span>
<span class="sd">        max_num_terms: Maximum number of terms in polynomial. If None, all possible terms are allowed.</span>
<span class="sd">        max_degree: Maximum degree of polynomial</span>
<span class="sd">        min_degree: Minimum degree of polynomial</span>
<span class="sd">        max_coeff: Maximum coefficient value (used for RR and ZZ)</span>
<span class="sd">        num_bound: Maximum absolute value of coefficients (used for QQ)</span>
<span class="sd">        degree_sampling: How to sample degree (&#39;uniform&#39; or &#39;fixed&#39;)</span>
<span class="sd">        term_sampling: How to sample number of terms (&#39;uniform&#39; or &#39;fixed&#39;)</span>
<span class="sd">        strictly_conditioned: Whether to strictly enforce conditions</span>
<span class="sd">        nonzero_instance: Whether to enforce non-zero instance</span>
<span class="sd">        nonzero_coeff: Whether to exclude zero coefficients during coefficient generation</span>
<span class="sd">        max_attempts: Maximum number of attempts to generate a polynomial satisfying conditions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate input parameters</span>
    <span class="k">if</span> <span class="n">ring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">symbols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify both ring and symbols/field_str/order&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="n">ring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">symbols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field_str</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Must specify either ring or all of symbols/field_str/order&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span> <span class="o">=</span> <span class="n">field_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_num_terms</span> <span class="o">=</span> <span class="n">max_num_terms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_degree</span> <span class="o">=</span> <span class="n">max_degree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_degree</span> <span class="o">=</span> <span class="n">min_degree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_coeff</span> <span class="o">=</span> <span class="n">max_coeff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_bound</span> <span class="o">=</span> <span class="n">num_bound</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">degree_sampling</span> <span class="o">=</span> <span class="n">degree_sampling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">term_sampling</span> <span class="o">=</span> <span class="n">term_sampling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strictly_conditioned</span> <span class="o">=</span> <span class="n">strictly_conditioned</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nonzero_instance</span> <span class="o">=</span> <span class="n">nonzero_instance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nonzero_coeff</span> <span class="o">=</span> <span class="n">nonzero_coeff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_attempts</span> <span class="o">=</span> <span class="n">max_attempts</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_field" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_field</span>


<a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_field" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_field</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert field_str to actual sympy domain object</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert field_str to actual sympy domain object&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">base_ring</span><span class="p">()</span>

    <span class="c1"># Standard field mapping</span>
    <span class="n">standard_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;QQ&quot;</span><span class="p">:</span> <span class="n">QQ</span><span class="p">,</span> <span class="s2">&quot;RR&quot;</span><span class="p">:</span> <span class="n">RR</span><span class="p">,</span> <span class="s2">&quot;ZZ&quot;</span><span class="p">:</span> <span class="n">ZZ</span><span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span> <span class="ow">in</span> <span class="n">standard_fields</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">standard_fields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="p">]</span>

    <span class="c1"># Finite field handling</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GF&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported field: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract field size based on format</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GF(&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field size must be greater than 1: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported field: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_ring" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_ring</span>


<a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.get_ring" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_ring</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PolynomialRing</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate polynomial ring</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PolynomialRing</code></td>            <td>
                  <code><span title="sage.all.PolynomialRing">PolynomialRing</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generated polynomial ring</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PolynomialRing</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate polynomial ring</span>

<span class="sd">    Returns:</span>
<span class="sd">        PolynomialRing: Generated polynomial ring</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_field</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.sample" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">sample</span>


<a href="#calt.dataset_generator.sagemath.utils.polynomial_sampler.PolynomialSampler.sample" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">sample</span><span class="p">(</span>
    <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">density</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">matrix_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MPolynomial_libsingular</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate random polynomial samples</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to generate</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, generate matrix of polynomials with given size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>density</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability of non-zero entries in matrix</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>matrix_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Special matrix type (e.g., 'unimodular_upper_triangular')</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular">MPolynomial_libsingular</span>] | <span title="list">list</span>[<span title="sage.all.matrix">matrix</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of polynomials or polynomial matrices</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sagemath/utils/polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">density</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">matrix_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MPolynomial_libsingular</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">matrix</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate random polynomial samples</span>

<span class="sd">    Args:</span>
<span class="sd">        num_samples: Number of samples to generate</span>
<span class="sd">        size: If provided, generate matrix of polynomials with given size</span>
<span class="sd">        density: Probability of non-zero entries in matrix</span>
<span class="sd">        matrix_type: Special matrix type (e.g., &#39;unimodular_upper_triangular&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of polynomials or polynomial matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_matrix</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">matrix_type</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample_polynomial</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="common-sympy-backend-example">Common (SymPy backend example)<a class="headerlink" href="#common-sympy-backend-example" title="Permanent link">&para;</a></h2>
<h3 id="generation-flow_1">Generation flow<a class="headerlink" href="#generation-flow_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sympy.dataset_generator.DatasetGenerator"></a>
    <div class="doc doc-contents first">


        <p>Base class for problem generators</p>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>backend</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Backend for parallel processing</p>
              </div>
            </td>
            <td>
                  <code>&#39;multiprocessing&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parallel jobs (-1 for all cores)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to display progress information</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_seed</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Root seed for reproducibility</p>
              </div>
            </td>
            <td>
                  <code>42</code>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sympy/dataset_generator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multiprocessing&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">root_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize problem generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        backend: Backend for parallel processing</span>
<span class="sd">        n_jobs: Number of parallel jobs (-1 for all cores)</span>
<span class="sd">        verbose: Whether to display progress information</span>
<span class="sd">        root_seed: Root seed for reproducibility</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_jobs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root_seed</span> <span class="o">=</span> <span class="n">root_seed</span>

    <span class="c1"># Configure logging only once at initialization</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="c1"># Configure joblib logging to show progress but not overwhelm</span>
    <span class="c1"># Only set if not already configured</span>
    <span class="n">joblib_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;joblib&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">joblib_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">:</span>
        <span class="n">joblib_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="n">parallel_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;joblib.Parallel&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parallel_logger</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">:</span>
        <span class="n">parallel_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.dataset_generator.DatasetGenerator.run" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run</span>


<a href="#calt.dataset_generator.sympy.dataset_generator.DatasetGenerator.run" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run</span><span class="p">(</span>
    <span class="n">dataset_sizes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">problem_generator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">statistics_calculator</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dataset_writer</span><span class="p">:</span> <span class="n">DatasetWriter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate multiple datasets using parallel processing with batch writing.</p>
<p>This is the main entry point for dataset generation. It supports generating
multiple datasets (train/test) simultaneously or separately, with efficient
memory management through batch processing and parallel execution.</p>
<p>Key features:
- Parallel processing using joblib for high performance
- Batch-based memory management to handle large datasets
- Incremental statistics calculation to avoid memory issues
- Reproducible generation with unique seeds for each sample
- Support for nested data structures (up to 2 levels)
- Multiple output formats (pickle, text, JSON) via DatasetWriter</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_sizes</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping dataset names to number of samples.
          Any string can be used as dataset name (e.g., "train", "test", "validation").
          Duplicate names are not allowed.
          Example: {"train": 100000, "test": 1000} or {"train": 100000, "validation": 5000}</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>problem_generator</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that generates (problem, solution) pair given a seed.
             Must accept a single integer seed parameter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>statistics_calculator</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional function to calculate sample-specific statistics.
                 Must accept (problem, solution) and return dict or None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_writer</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter" href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter">DatasetWriter</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DatasetWriter object for saving datasets to files.
          If None, a new DatasetWriter will be created using save_dir, save_text, and save_json parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to process in each batch. Larger batches
       use more memory but may be more efficient for I/O operations.</p>
              </div>
            </td>
            <td>
                  <code>100000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for saving datasets. Used only if dataset_writer is None.
     If None, uses current working directory.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_text</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save raw text files. Used only if dataset_writer is None.
      Text files use "#" as separator between problem and solution.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_json</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save JSON Lines files. Used only if dataset_writer is None.
      JSON Lines files preserve the original nested structure format.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If dataset_sizes is invalid or problem_generator is None</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If parallel processing fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Each sample gets a unique seed for reproducibility</li>
<li>Progress is logged if verbose=True (set in <strong>init</strong>)</li>
<li>Memory usage scales with batch_size, not total dataset size</li>
<li>Statistics are calculated incrementally to handle large datasets</li>
<li>If dataset_writer is provided, save_dir, save_text, and save_json parameters are ignored</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define problem generator function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">polynomial_generator</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="gp">... </span>    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># Generate random polynomial problem</span>
<span class="gp">... </span>    <span class="n">problem</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))]</span>
<span class="gp">... </span>    <span class="n">solution</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">problem</span><span class="p">,</span> <span class="n">solution</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initialize dataset generator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span> <span class="o">=</span> <span class="n">DatasetGenerator</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Method 1: Automatic DatasetWriter creation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;validation&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Method 2: Manual DatasetWriter creation (for advanced use cases)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">calt.dataset_generator.sympy</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetWriter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span> <span class="o">=</span> <span class="n">DatasetWriter</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span> <span class="n">save_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dataset_writer</span><span class="o">=</span><span class="n">writer</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Method 3: Generate datasets separately (if needed)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset_sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;validation&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">problem_generator</span><span class="o">=</span><span class="n">polynomial_generator</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/dataset_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataset_sizes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">problem_generator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">statistics_calculator</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dataset_writer</span><span class="p">:</span> <span class="n">DatasetWriter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate multiple datasets using parallel processing with batch writing.</span>

<span class="sd">    This is the main entry point for dataset generation. It supports generating</span>
<span class="sd">    multiple datasets (train/test) simultaneously or separately, with efficient</span>
<span class="sd">    memory management through batch processing and parallel execution.</span>

<span class="sd">    Key features:</span>
<span class="sd">    - Parallel processing using joblib for high performance</span>
<span class="sd">    - Batch-based memory management to handle large datasets</span>
<span class="sd">    - Incremental statistics calculation to avoid memory issues</span>
<span class="sd">    - Reproducible generation with unique seeds for each sample</span>
<span class="sd">    - Support for nested data structures (up to 2 levels)</span>
<span class="sd">    - Multiple output formats (pickle, text, JSON) via DatasetWriter</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_sizes: Dictionary mapping dataset names to number of samples.</span>
<span class="sd">                      Any string can be used as dataset name (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;).</span>
<span class="sd">                      Duplicate names are not allowed.</span>
<span class="sd">                      Example: {&quot;train&quot;: 100000, &quot;test&quot;: 1000} or {&quot;train&quot;: 100000, &quot;validation&quot;: 5000}</span>
<span class="sd">        problem_generator: Function that generates (problem, solution) pair given a seed.</span>
<span class="sd">                         Must accept a single integer seed parameter.</span>
<span class="sd">        statistics_calculator: Optional function to calculate sample-specific statistics.</span>
<span class="sd">                             Must accept (problem, solution) and return dict or None.</span>
<span class="sd">        dataset_writer: DatasetWriter object for saving datasets to files.</span>
<span class="sd">                      If None, a new DatasetWriter will be created using save_dir, save_text, and save_json parameters.</span>
<span class="sd">        batch_size: Number of samples to process in each batch. Larger batches</span>
<span class="sd">                   use more memory but may be more efficient for I/O operations.</span>
<span class="sd">        save_dir: Base directory for saving datasets. Used only if dataset_writer is None.</span>
<span class="sd">                 If None, uses current working directory.</span>
<span class="sd">        save_text: Whether to save raw text files. Used only if dataset_writer is None.</span>
<span class="sd">                  Text files use &quot;#&quot; as separator between problem and solution.</span>
<span class="sd">        save_json: Whether to save JSON Lines files. Used only if dataset_writer is None.</span>
<span class="sd">                  JSON Lines files preserve the original nested structure format.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If dataset_sizes is invalid or problem_generator is None</span>
<span class="sd">        Exception: If parallel processing fails</span>

<span class="sd">    Note:</span>
<span class="sd">        - Each sample gets a unique seed for reproducibility</span>
<span class="sd">        - Progress is logged if verbose=True (set in __init__)</span>
<span class="sd">        - Memory usage scales with batch_size, not total dataset size</span>
<span class="sd">        - Statistics are calculated incrementally to handle large datasets</span>
<span class="sd">        - If dataset_writer is provided, save_dir, save_text, and save_json parameters are ignored</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Define problem generator function</span>
<span class="sd">        &gt;&gt;&gt; def polynomial_generator(seed):</span>
<span class="sd">        ...     import random</span>
<span class="sd">        ...     random.seed(seed)</span>
<span class="sd">        ...     # Generate random polynomial problem</span>
<span class="sd">        ...     problem = [random.randint(1, 1000) for _ in range(random.randint(1, 10))]</span>
<span class="sd">        ...     solution = sum(problem)</span>
<span class="sd">        ...     return problem, solution</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Initialize dataset generator</span>
<span class="sd">        &gt;&gt;&gt; generator = DatasetGenerator(n_jobs=-1, verbose=True)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Method 1: Automatic DatasetWriter creation</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;train&quot;: 10000, &quot;test&quot;: 1000, &quot;validation&quot;: 500},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     save_dir=&quot;./datasets&quot;,</span>
<span class="sd">        ...     save_text=True,</span>
<span class="sd">        ...     save_json=True,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Method 2: Manual DatasetWriter creation (for advanced use cases)</span>
<span class="sd">        &gt;&gt;&gt; from calt.dataset_generator.sympy import DatasetWriter</span>
<span class="sd">        &gt;&gt;&gt; writer = DatasetWriter(save_dir=&quot;./datasets&quot;, save_text=True, save_json=True)</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;train&quot;: 10000, &quot;test&quot;: 1000},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     dataset_writer=writer,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Method 3: Generate datasets separately (if needed)</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;train&quot;: 10000},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     save_dir=&quot;./datasets&quot;,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; generator.run(</span>
<span class="sd">        ...     dataset_sizes={&quot;test&quot;: 1000, &quot;validation&quot;: 500},</span>
<span class="sd">        ...     problem_generator=polynomial_generator,</span>
<span class="sd">        ...     save_dir=&quot;./datasets&quot;,</span>
<span class="sd">        ...     batch_size=100</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create DatasetWriter if not provided</span>
    <span class="k">if</span> <span class="n">dataset_writer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dataset_writer</span> <span class="o">=</span> <span class="n">DatasetWriter</span><span class="p">(</span>
            <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span>
            <span class="n">save_text</span><span class="o">=</span><span class="n">save_text</span><span class="p">,</span>
            <span class="n">save_json</span><span class="o">=</span><span class="n">save_json</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;save_dir: </span><span class="si">{</span><span class="n">dataset_writer</span><span class="o">.</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text output: </span><span class="si">{</span><span class="n">save_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON output: </span><span class="si">{</span><span class="n">save_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Prepare common arguments</span>
    <span class="n">common_args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;problem_generator&quot;</span><span class="p">:</span> <span class="n">problem_generator</span><span class="p">,</span>
        <span class="s2">&quot;statistics_calculator&quot;</span><span class="p">:</span> <span class="n">statistics_calculator</span><span class="p">,</span>
        <span class="s2">&quot;dataset_writer&quot;</span><span class="p">:</span> <span class="n">dataset_writer</span><span class="p">,</span>
        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">batch_size</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Validate dataset_sizes</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dataset_sizes must be a dictionary&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dataset_sizes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dataset_sizes cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">problem_generator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;problem_generator must be provided&quot;</span><span class="p">)</span>

    <span class="c1"># Check for duplicate dataset names</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duplicate dataset names are not allowed&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">num_samples</span> <span class="ow">in</span> <span class="n">dataset_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">num_samples</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Number of samples must be a positive integer, got </span><span class="si">{</span><span class="n">num_samples</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Log overall generation start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;=========================== Dataset generation ===========================</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Starting dataset generation for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_sizes</span><span class="p">)</span><span class="si">}</span><span class="s2"> dataset(s)&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset sizes: </span><span class="si">{</span><span class="n">dataset_sizes</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate each dataset</span>
    <span class="k">for</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">num_samples</span> <span class="ow">in</span> <span class="n">dataset_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_dataset</span><span class="p">(</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span> <span class="o">**</span><span class="n">common_args</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All datasets generated successfully!&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;==========================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="writing-and-statistics_1">Writing and statistics<a class="headerlink" href="#writing-and-statistics_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter"></a>
    <div class="doc doc-contents first">


        <p>Dataset writer for saving problem-solution pairs in multiple formats.</p>
<p>This class handles saving datasets with nested structure support up to 2 levels.
It can save data in pickle (binary), raw text, and JSON Lines formats.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.INNER_SEP">INNER_SEP</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator for single-level lists (" | ")</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.OUTER_SEP">OUTER_SEP</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Separator for nested lists (" || ")</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_dir">save_dir</span></code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for saving datasets</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_text">save_text</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save raw text files</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_json">save_json</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save JSON Lines files</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter._file_handles">_file_handles</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store open file handles</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>save_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory for saving datasets. If None, uses current working directory.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_text</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save raw text files. Text files use "#" as separator
      between problem and solution, with nested structures joined by separators.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_json</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save JSON Lines files. JSON Lines files preserve the original
      nested structure format, with one sample per line.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Pickle files are always saved as they are the primary format for data loading.
Text and JSON Lines files are optional and controlled by save_text and save_json flags.</p>
</details>

<details class="usage" open>
  <summary>Usage</summary>
  <h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management">Efficient batch processing with file handle management<a class="headerlink" href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--efficient-batch-processing-with-file-handle-management" title="Permanent link">&para;</a></h2>
<p>writer = DatasetWriter(save_dir="./datasets")
writer.open("train")  # Open file handles once
try:
    for batch_idx, samples in enumerate(batches):
        writer.save_batch(samples, tag="train", batch_idx=batch_idx)
finally:
    writer.close("train")  # Close file handles</p>
<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--or-use-context-manager">Or use context manager<a class="headerlink" href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--or-use-context-manager" title="Permanent link">&para;</a></h2>
<p>with DatasetWriter(save_dir="./datasets") as writer:
    writer.open("train")
    for batch_idx, samples in enumerate(batches):
        writer.save_batch(samples, tag="train", batch_idx=batch_idx)
    writer.close("train")</p>
<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits">Support for various dataset splits<a class="headerlink" href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter--support-for-various-dataset-splits" title="Permanent link">&para;</a></h2>
<p>writer.open("validation")  # Validation set
writer.open("dev")         # Development set
writer.open("eval")        # Evaluation set</p>
</details>






                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize dataset writer.</span>

<span class="sd">    Args:</span>
<span class="sd">        save_dir: Base directory for saving datasets. If None, uses current working directory.</span>
<span class="sd">        save_text: Whether to save raw text files. Text files use &quot;#&quot; as separator</span>
<span class="sd">                  between problem and solution, with nested structures joined by separators.</span>
<span class="sd">        save_json: Whether to save JSON Lines files. JSON Lines files preserve the original</span>
<span class="sd">                  nested structure format, with one sample per line.</span>

<span class="sd">    Note:</span>
<span class="sd">        Pickle files are always saved as they are the primary format for data loading.</span>
<span class="sd">        Text and JSON Lines files are optional and controlled by save_text and save_json flags.</span>

<span class="sd">    Usage:</span>
<span class="sd">        # Efficient batch processing with file handle management</span>
<span class="sd">        writer = DatasetWriter(save_dir=&quot;./datasets&quot;)</span>
<span class="sd">        writer.open(&quot;train&quot;)  # Open file handles once</span>
<span class="sd">        try:</span>
<span class="sd">            for batch_idx, samples in enumerate(batches):</span>
<span class="sd">                writer.save_batch(samples, tag=&quot;train&quot;, batch_idx=batch_idx)</span>
<span class="sd">        finally:</span>
<span class="sd">            writer.close(&quot;train&quot;)  # Close file handles</span>

<span class="sd">        # Or use context manager</span>
<span class="sd">        with DatasetWriter(save_dir=&quot;./datasets&quot;) as writer:</span>
<span class="sd">            writer.open(&quot;train&quot;)</span>
<span class="sd">            for batch_idx, samples in enumerate(batches):</span>
<span class="sd">                writer.save_batch(samples, tag=&quot;train&quot;, batch_idx=batch_idx)</span>
<span class="sd">            writer.close(&quot;train&quot;)</span>

<span class="sd">        # Support for various dataset splits</span>
<span class="sd">        writer.open(&quot;validation&quot;)  # Validation set</span>
<span class="sd">        writer.open(&quot;dev&quot;)         # Development set</span>
<span class="sd">        writer.open(&quot;eval&quot;)        # Evaluation set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">save_dir</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_text</span> <span class="o">=</span> <span class="n">save_text</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_json</span> <span class="o">=</span> <span class="n">save_json</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {tag: {file_type: file_handle}}</span>
    <span class="n">TimedeltaDumper</span><span class="o">.</span><span class="n">add_representer</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">timedelta_representer</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.open" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">open</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.open" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">open</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Open file handles for the specified tag.</p>
<p>This method should be called before starting batch processing to avoid
repeated file open/close operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open file handles for the specified tag.</span>

<span class="sd">    This method should be called before starting batch processing to avoid</span>
<span class="sd">    repeated file open/close operations.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File handles for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; are already open&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">dataset_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_dir</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Create batch directory for pickle files</span>
    <span class="n">batch_dir</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_batches&quot;</span>
    <span class="n">batch_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Open text file if enabled</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_text</span><span class="p">:</span>
        <span class="n">raw_path</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_raw.txt&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">raw_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

    <span class="c1"># Open JSON Lines file if enabled</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_json</span><span class="p">:</span>
        <span class="n">json_path</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_data.jsonl&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">close</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">close</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Close file handles for the specified tag.</p>
<p>This method should be called after finishing batch processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Close file handles for the specified tag.</span>

<span class="sd">    This method should be called after finishing batch processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No open file handles found for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Combine batch files into final pickle file</span>
    <span class="k">if</span> <span class="s2">&quot;batch_dir&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_combine_batch_files</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="c1"># Close all open file handles</span>
    <span class="k">for</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">file_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>  <span class="c1"># Only close actual file handles</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error closing </span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2"> file for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close_all" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">close_all</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.close_all" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">close_all</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Close all open file handles.</p>
<p>This method should be called when the writer is no longer needed.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Close all open file handles.</span>

<span class="sd">    This method should be called when the writer is no longer needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__enter__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__enter__</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__enter__" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__enter__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager entry.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager entry.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__exit__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__exit__</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.__exit__" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager exit - close all files.</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager exit - close all files.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">close_all</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_batch" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">save_batch</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_batch" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">save_batch</span><span class="p">(</span>
    <span class="n">samples</span><span class="p">:</span> <span class="n">StringSampleList</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Save a batch of samples to files in multiple formats.</p>
<p>This method saves samples in three formats:
1. Pickle (.pkl) - Binary format, always saved, used for loading
2. Raw text (.txt) - Human-readable format with separators (if save_text=True)
3. JSON Lines (.jsonl) - Structured format preserving nested structure (if save_json=True)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>samples</code>
            </td>
            <td>
                  <code><span title="calt.dataset_generator.sympy.utils.dataset_writer.StringSampleList">StringSampleList</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (problem, solution) pairs in string format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                  <code>&#39;train&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch index for incremental saving. Use 0 for first batch,
      subsequent batches will append to existing files.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid or samples contain invalid nested structures</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple string samples (single problem-solution pairs)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span> <span class="o">=</span> <span class="n">DatasetWriter</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;./datasets&quot;</span><span class="p">,</span> <span class="n">save_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;x^2 + 2*x + 1&quot;</span><span class="p">,</span> <span class="s2">&quot;(x + 1)^2&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s2">&quot;2*x^3 - 3*x^2&quot;</span><span class="p">,</span> <span class="s2">&quot;x^2*(2*x - 3)&quot;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Creates: train_data.pkl, train_raw.txt, train_data.jsonl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 1 level nested structure samples (multiple problems/solutions)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">([</span><span class="s2">&quot;x + y&quot;</span><span class="p">,</span> <span class="s2">&quot;x - y&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;2*x&quot;</span><span class="p">,</span> <span class="s2">&quot;2*y&quot;</span><span class="p">]),</span>
<span class="gp">... </span>    <span class="p">([</span><span class="s2">&quot;x^2 + y^2&quot;</span><span class="p">,</span> <span class="s2">&quot;x^2 - y^2&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;2*x^2&quot;</span><span class="p">,</span> <span class="s2">&quot;2*y^2&quot;</span><span class="p">]),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Text output: &quot;x + y | x - y # 2*x | 2*y&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 2 level nested structure samples (complex nested problems)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]]),</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;x + y&quot;</span><span class="p">,</span> <span class="s2">&quot;x - y&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;z + w&quot;</span><span class="p">,</span> <span class="s2">&quot;z - w&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;x + y&quot;</span><span class="p">,</span> <span class="s2">&quot;z + w&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;x - y&quot;</span><span class="p">,</span> <span class="s2">&quot;z - w&quot;</span><span class="p">]]),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Text output: &quot;x | y || z | w # x | z || y | w&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Append more samples to existing dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">more_samples</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">]]),</span>
<span class="gp">... </span>    <span class="p">([[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">]],</span> <span class="p">[[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">]]),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Appends to existing files instead of overwriting</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">writer</span><span class="o">.</span><span class="n">save_batch</span><span class="p">(</span><span class="n">more_samples</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">samples</span><span class="p">:</span> <span class="n">StringSampleList</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
    <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a batch of samples to files in multiple formats.</span>

<span class="sd">    This method saves samples in three formats:</span>
<span class="sd">    1. Pickle (.pkl) - Binary format, always saved, used for loading</span>
<span class="sd">    2. Raw text (.txt) - Human-readable format with separators (if save_text=True)</span>
<span class="sd">    3. JSON Lines (.jsonl) - Structured format preserving nested structure (if save_json=True)</span>

<span class="sd">    Args:</span>
<span class="sd">        samples: List of (problem, solution) pairs in string format</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>
<span class="sd">        batch_idx: Batch index for incremental saving. Use 0 for first batch,</span>
<span class="sd">                  subsequent batches will append to existing files.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid or samples contain invalid nested structures</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Simple string samples (single problem-solution pairs)</span>
<span class="sd">        &gt;&gt;&gt; writer = DatasetWriter(save_dir=&quot;./datasets&quot;, save_text=True, save_json=True)</span>
<span class="sd">        &gt;&gt;&gt; samples = [</span>
<span class="sd">        ...     (&quot;x^2 + 2*x + 1&quot;, &quot;(x + 1)^2&quot;),</span>
<span class="sd">        ...     (&quot;2*x^3 - 3*x^2&quot;, &quot;x^2*(2*x - 3)&quot;),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Creates: train_data.pkl, train_raw.txt, train_data.jsonl</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(samples, tag=&quot;train&quot;, batch_idx=0)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # 1 level nested structure samples (multiple problems/solutions)</span>
<span class="sd">        &gt;&gt;&gt; samples = [</span>
<span class="sd">        ...     ([&quot;x + y&quot;, &quot;x - y&quot;], [&quot;2*x&quot;, &quot;2*y&quot;]),</span>
<span class="sd">        ...     ([&quot;x^2 + y^2&quot;, &quot;x^2 - y^2&quot;], [&quot;2*x^2&quot;, &quot;2*y^2&quot;]),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Text output: &quot;x + y | x - y # 2*x | 2*y&quot;</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(samples, tag=&quot;test&quot;, batch_idx=0)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # 2 level nested structure samples (complex nested problems)</span>
<span class="sd">        &gt;&gt;&gt; samples = [</span>
<span class="sd">        ...     ([[&quot;x&quot;, &quot;y&quot;], [&quot;z&quot;, &quot;w&quot;]], [[&quot;x&quot;, &quot;z&quot;], [&quot;y&quot;, &quot;w&quot;]]),</span>
<span class="sd">        ...     ([[&quot;x + y&quot;, &quot;x - y&quot;], [&quot;z + w&quot;, &quot;z - w&quot;]], [[&quot;x + y&quot;, &quot;z + w&quot;], [&quot;x - y&quot;, &quot;z - w&quot;]]),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Text output: &quot;x | y || z | w # x | z || y | w&quot;</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(samples, tag=&quot;test&quot;, batch_idx=0)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Append more samples to existing dataset</span>
<span class="sd">        &gt;&gt;&gt; more_samples = [</span>
<span class="sd">        ...     ([[&quot;a&quot;, &quot;b&quot;], [&quot;c&quot;, &quot;d&quot;]], [[&quot;a&quot;, &quot;c&quot;], [&quot;b&quot;, &quot;d&quot;]]),</span>
<span class="sd">        ...     ([[&quot;e&quot;, &quot;f&quot;], [&quot;g&quot;, &quot;h&quot;]], [[&quot;e&quot;, &quot;g&quot;], [&quot;f&quot;, &quot;h&quot;]]),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; # Appends to existing files instead of overwriting</span>
<span class="sd">        &gt;&gt;&gt; writer.save_batch(more_samples, tag=&quot;train&quot;, batch_idx=1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="c1"># Validate samples</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">samples</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Empty samples list provided - no files will be created&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Check if file handles are open for this tag</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">:</span>
        <span class="c1"># Fallback to old method if file handles are not open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_batch_legacy</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Save binary data (pickle format) - save batch individually</span>
    <span class="n">batch_file</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_dir&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;batch_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s1">&#39;batch_count&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">06d</span><span class="si">}</span><span class="s2">.pkl&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">batch_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;batch_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Save raw text data (optional)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_text</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
            <span class="n">formatted_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_sample_strings</span><span class="p">(</span><span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted_line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="c1"># Save JSON Lines data (optional)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_json</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_json_data</span><span class="p">(</span><span class="n">problem_str</span><span class="p">,</span> <span class="n">solution_str</span><span class="p">)</span>
            <span class="n">json_line</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">json_line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_handles</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_final_statistics" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">save_final_statistics</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.save_final_statistics" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">save_final_statistics</span><span class="p">(</span><span class="n">statistics</span><span class="p">:</span> <span class="n">StatisticsDict</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;train&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Save final overall statistics to YAML file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>statistics</code>
            </td>
            <td>
                  <code><span title="calt.dataset_generator.sympy.utils.dataset_writer.StatisticsDict">StatisticsDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing dataset statistics</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                  <code>&#39;train&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Statistics are saved in YAML format for human readability.
The file is named "{tag}_stats.yaml" in the dataset directory.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_final_statistics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">statistics</span><span class="p">:</span> <span class="n">StatisticsDict</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save final overall statistics to YAML file.</span>

<span class="sd">    Args:</span>
<span class="sd">        statistics: Dictionary containing dataset statistics</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>

<span class="sd">    Note:</span>
<span class="sd">        Statistics are saved in YAML format for human readability.</span>
<span class="sd">        The file is named &quot;{tag}_stats.yaml&quot; in the dataset directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">dataset_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_dir</span><span class="p">()</span>

    <span class="n">stats_path</span> <span class="o">=</span> <span class="n">dataset_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_stats.yaml&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stats_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="n">statistics</span><span class="p">,</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="n">Dumper</span><span class="o">=</span><span class="n">TimedeltaDumper</span><span class="p">,</span>
            <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_dataset</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_dataset</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load dataset from pickle file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="calt.dataset_generator.sympy.utils.dataset_writer.StringSampleList">StringSampleList</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (problem, solution) pairs in string format</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the pickle file doesn't exist</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">problem</span><span class="p">,</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem: </span><span class="si">{</span><span class="n">problem</span><span class="si">}</span><span class="s2">, Solution: </span><span class="si">{</span><span class="n">solution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load dataset from pickle file.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of (problem, solution) pairs in string format</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">        FileNotFoundError: If the pickle file doesn&#39;t exist</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; samples = writer.load_dataset(&quot;train&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Loaded {len(samples)} samples&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for problem, solution in samples[:3]:</span>
<span class="sd">        ...     print(f&quot;Problem: {problem}, Solution: {solution}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">pickle_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_data.pkl&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pickle_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset file not found: </span><span class="si">{</span><span class="n">pickle_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_dataset_jsonl</span>


<a href="#calt.dataset_generator.sympy.utils.dataset_writer.DatasetWriter.load_dataset_jsonl" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_dataset_jsonl</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load dataset from JSON Lines file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset tag (e.g., "train", "test", "validation", "dev", "eval")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="calt.dataset_generator.sympy.utils.dataset_writer.StringSampleList">StringSampleList</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (problem, solution) pairs in string format</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tag is invalid</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the JSON Lines file doesn't exist</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">load_dataset_jsonl</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">problem</span><span class="p">,</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem: </span><span class="si">{</span><span class="n">problem</span><span class="si">}</span><span class="s2">, Solution: </span><span class="si">{</span><span class="n">solution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/dataset_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_dataset_jsonl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringSampleList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load dataset from JSON Lines file.</span>

<span class="sd">    Args:</span>
<span class="sd">        tag: Dataset tag (e.g., &quot;train&quot;, &quot;test&quot;, &quot;validation&quot;, &quot;dev&quot;, &quot;eval&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of (problem, solution) pairs in string format</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tag is invalid</span>
<span class="sd">        FileNotFoundError: If the JSON Lines file doesn&#39;t exist</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; samples = writer.load_dataset_jsonl(&quot;train&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Loaded {len(samples)} samples&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for problem, solution in samples[:3]:</span>
<span class="sd">        ...     print(f&quot;Problem: {problem}, Solution: {solution}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">jsonl_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">_data.jsonl&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">jsonl_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON Lines file not found: </span><span class="si">{</span><span class="n">jsonl_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonl_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Skip empty lines</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">problem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;problem&quot;</span><span class="p">]</span>
                <span class="n">solution</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;solution&quot;</span><span class="p">]</span>
                <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">problem</span><span class="p">,</span> <span class="n">solution</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

    <span class="k">return</span> <span class="n">samples</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator"></a>
    <div class="doc doc-contents first">


        <p>Memory-efficient statistics calculator that uses incremental computation.</p>
<p>This calculator avoids storing all data in memory by computing statistics
incrementally as batches are processed using Welford's online algorithm
for numerical stability and memory efficiency. All standard deviations
are calculated as population standard deviations.</p>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/statistics_calculator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize incremental sample statistics calculator.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">runtime_stats</span> <span class="o">=</span> <span class="n">IncrementalStatistics</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store aggregated sample statistics by category</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_batch</span>


<a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.update_batch" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">update_batch</span><span class="p">(</span>
    <span class="n">runtimes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">batch_sample_stats</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Update statistics with a batch of results using Welford's online algorithm.</p>
<p>This method processes each sample individually, updating both runtime
statistics and sample-specific statistics incrementally for better
control and efficiency.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>runtimes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of runtime values for each sample in the batch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_sample_stats</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="int">int</span> | <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of sample statistics dictionaries for the current batch.
               Each dictionary has the structure:
               {"category1": {"metric1": value1, ...},
                "category2": {"metric1": value1, ...}}
               Example:
               [{"problem": {"total_degree": 2, "num_polynomials": 3},
                 "solution": {"total_degree": 3, "num_polynomials": 3}},
                {"problem": {"total_degree": 5, "num_polynomials": 4},
                 "solution": {"total_degree": 8, "num_polynomials": 4}},
                ...]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/statistics_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">runtimes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">batch_sample_stats</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update statistics with a batch of results using Welford&#39;s online algorithm.</span>

<span class="sd">    This method processes each sample individually, updating both runtime</span>
<span class="sd">    statistics and sample-specific statistics incrementally for better</span>
<span class="sd">    control and efficiency.</span>

<span class="sd">    Args:</span>
<span class="sd">        runtimes: List of runtime values for each sample in the batch</span>
<span class="sd">        batch_sample_stats: List of sample statistics dictionaries for the current batch.</span>
<span class="sd">                           Each dictionary has the structure:</span>
<span class="sd">                           {&quot;category1&quot;: {&quot;metric1&quot;: value1, ...},</span>
<span class="sd">                            &quot;category2&quot;: {&quot;metric1&quot;: value1, ...}}</span>
<span class="sd">                           Example:</span>
<span class="sd">                           [{&quot;problem&quot;: {&quot;total_degree&quot;: 2, &quot;num_polynomials&quot;: 3},</span>
<span class="sd">                             &quot;solution&quot;: {&quot;total_degree&quot;: 3, &quot;num_polynomials&quot;: 3}},</span>
<span class="sd">                            {&quot;problem&quot;: {&quot;total_degree&quot;: 5, &quot;num_polynomials&quot;: 4},</span>
<span class="sd">                             &quot;solution&quot;: {&quot;total_degree&quot;: 8, &quot;num_polynomials&quot;: 4}},</span>
<span class="sd">                            ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Update runtime statistics</span>
    <span class="k">for</span> <span class="n">runtime</span> <span class="ow">in</span> <span class="n">runtimes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>

    <span class="c1"># Update sample statistics</span>
    <span class="k">for</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">batch_sample_stats</span><span class="p">:</span>
        <span class="c1"># Update each numeric sample statistic incrementally</span>
        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">category_stats</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_stats</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># Handle nested structure like {&quot;problem&quot;: {...}, &quot;solution&quot;: {...}}</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">category_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">stat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">stat_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">IncrementalStatistics</span><span class="p">()</span>
                            <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">stat_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_stats</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="c1"># Handle flat structure</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">IncrementalStatistics</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">category_stats</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_overall_statistics</span>


<a href="#calt.dataset_generator.sympy.utils.statistics_calculator.MemoryEfficientStatisticsCalculator.get_overall_statistics" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_overall_statistics</span><span class="p">(</span><span class="n">total_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get overall statistics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>total_time</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total processing time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of samples</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing overall statistics with the structure:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{
"total_time": float,
"num_samples": int,
"samples_per_second": float,
"generation_time": {"mean": float, "std": float, "min": float, "max": float},
"problem_stats": {"metric1": {"mean": float, "std": float, "min": float, "max": float}, ...},
"solution_stats": {"metric1": {"mean": float, "std": float, "min": float, "max": float}, ...}</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>}</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/statistics_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_overall_statistics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">total_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get overall statistics.</span>

<span class="sd">    Args:</span>
<span class="sd">        total_time: Total processing time</span>
<span class="sd">        num_samples: Total number of samples</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing overall statistics with the structure:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;total_time&quot;: float,</span>
<span class="sd">            &quot;num_samples&quot;: int,</span>
<span class="sd">            &quot;samples_per_second&quot;: float,</span>
<span class="sd">            &quot;generation_time&quot;: {&quot;mean&quot;: float, &quot;std&quot;: float, &quot;min&quot;: float, &quot;max&quot;: float},</span>
<span class="sd">            &quot;problem_stats&quot;: {&quot;metric1&quot;: {&quot;mean&quot;: float, &quot;std&quot;: float, &quot;min&quot;: float, &quot;max&quot;: float}, ...},</span>
<span class="sd">            &quot;solution_stats&quot;: {&quot;metric1&quot;: {&quot;mean&quot;: float, &quot;std&quot;: float, &quot;min&quot;: float, &quot;max&quot;: float}, ...}</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">runtime_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_stats</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>

    <span class="n">overall_stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="n">total_time</span><span class="p">,</span>
        <span class="s2">&quot;num_samples&quot;</span><span class="p">:</span> <span class="n">num_samples</span><span class="p">,</span>
        <span class="s2">&quot;samples_per_second&quot;</span><span class="p">:</span> <span class="n">num_samples</span> <span class="o">/</span> <span class="n">total_time</span> <span class="k">if</span> <span class="n">total_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;generation_time&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">],</span>
            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">runtime_stats</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># Add sample statistics by category</span>
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">category_stats</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category_stats</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Handle nested structure like {&quot;problem&quot;: {...}, &quot;solution&quot;: {...}}</span>
            <span class="n">overall_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">stat_name</span><span class="p">:</span> <span class="n">stat_calc</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">stat_name</span><span class="p">,</span> <span class="n">stat_calc</span> <span class="ow">in</span> <span class="n">category_stats</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Handle flat structure</span>
            <span class="n">overall_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">category_stats</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">overall_stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="sampling_1">Sampling<a class="headerlink" href="#sampling_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler"></a>
    <div class="doc doc-contents first">


        <p>Generator for random polynomials with specific constraints</p>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbols</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbols of polynomial ring</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field of polynomial ring</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="sympy.polys.orderings.MonomialOrder">MonomialOrder</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order of polynomial ring</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_num_terms</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of terms in polynomial. If None, all possible terms are allowed.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum degree of polynomial</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum degree of polynomial</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_coeff</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum coefficient value</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bound</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum absolute value of coefficients</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>degree_sampling</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to sample degree ('uniform' or 'fixed')</p>
              </div>
            </td>
            <td>
                  <code>&#39;uniform&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>term_sampling</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to sample number of terms ('uniform' or 'fixed')</p>
              </div>
            </td>
            <td>
                  <code>&#39;uniform&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strictly_conditioned</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to strictly enforce conditions</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nonzero_instance</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to enforce non-zero instance</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_attempts</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of attempts to generate a polynomial satisfying conditions</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/polynomial_sampler.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">symbols</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">field_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">MonomialOrder</span><span class="p">,</span>
    <span class="n">max_num_terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">min_degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">degree_sampling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>  <span class="c1"># &#39;uniform&#39; or &#39;fixed&#39;</span>
    <span class="n">term_sampling</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>  <span class="c1"># &#39;uniform&#39; or &#39;fixed&#39;</span>
    <span class="n">max_coeff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Used for RR and ZZ</span>
    <span class="n">num_bound</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Used for QQ</span>
    <span class="n">strictly_conditioned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">nonzero_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize polynomial sampler</span>

<span class="sd">    Args:</span>
<span class="sd">        symbols: Symbols of polynomial ring</span>
<span class="sd">        field_str: Field of polynomial ring</span>
<span class="sd">        order: Order of polynomial ring</span>
<span class="sd">        max_num_terms: Maximum number of terms in polynomial. If None, all possible terms are allowed.</span>
<span class="sd">        max_degree: Maximum degree of polynomial</span>
<span class="sd">        min_degree: Minimum degree of polynomial</span>
<span class="sd">        max_coeff: Maximum coefficient value</span>
<span class="sd">        num_bound: Maximum absolute value of coefficients</span>
<span class="sd">        degree_sampling: How to sample degree (&#39;uniform&#39; or &#39;fixed&#39;)</span>
<span class="sd">        term_sampling: How to sample number of terms (&#39;uniform&#39; or &#39;fixed&#39;)</span>
<span class="sd">        strictly_conditioned: Whether to strictly enforce conditions</span>
<span class="sd">        nonzero_instance: Whether to enforce non-zero instance</span>
<span class="sd">        max_attempts: Maximum number of attempts to generate a polynomial satisfying conditions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">symbols</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span> <span class="o">=</span> <span class="n">field_str</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_num_terms</span> <span class="o">=</span> <span class="n">max_num_terms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_degree</span> <span class="o">=</span> <span class="n">max_degree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">min_degree</span> <span class="o">=</span> <span class="n">min_degree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_coeff</span> <span class="o">=</span> <span class="n">max_coeff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_bound</span> <span class="o">=</span> <span class="n">num_bound</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">degree_sampling</span> <span class="o">=</span> <span class="n">degree_sampling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">term_sampling</span> <span class="o">=</span> <span class="n">term_sampling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strictly_conditioned</span> <span class="o">=</span> <span class="n">strictly_conditioned</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nonzero_instance</span> <span class="o">=</span> <span class="n">nonzero_instance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_attempts</span> <span class="o">=</span> <span class="n">max_attempts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">single_poly_sampler</span> <span class="o">=</span> <span class="n">SinglePolynomialSampler</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_field" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_field</span>


<a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_field" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_field</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Domain</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert field_str to actual sympy domain object</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Domain</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert field_str to actual sympy domain object&quot;&quot;&quot;</span>
    <span class="c1"># Standard field mapping</span>
    <span class="n">standard_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;QQ&quot;</span><span class="p">:</span> <span class="n">QQ</span><span class="p">,</span> <span class="s2">&quot;RR&quot;</span><span class="p">:</span> <span class="n">RR</span><span class="p">,</span> <span class="s2">&quot;ZZ&quot;</span><span class="p">:</span> <span class="n">ZZ</span><span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span> <span class="ow">in</span> <span class="n">standard_fields</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">standard_fields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="p">]</span>

    <span class="c1"># Finite field handling</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GF&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported field: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract field size based on format</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GF(&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field size must be greater than 1: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported field: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_ring" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_ring</span>


<a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.get_ring" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_ring</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PolyRing</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate polynomial ring</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PolyRing</code></td>            <td>
                  <code><span title="sympy.polys.rings.PolyRing">PolyRing</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Generated polynomial ring</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PolyRing</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate polynomial ring</span>

<span class="sd">    Returns:</span>
<span class="sd">        PolyRing: Generated polynomial ring</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">R</span><span class="p">,</span> <span class="o">*</span><span class="n">gens</span> <span class="o">=</span> <span class="n">ring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.sample" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">sample</span>


<a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.sample" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">sample</span><span class="p">(</span>
    <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">density</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">matrix_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">PolyElement</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate random polynomial samples</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to generate</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, generate matrix of polynomials with given size</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>density</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability of non-zero entries in matrix</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>matrix_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Special matrix type (e.g., 'unimodular_upper_triangular')</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="sympy.polys.rings.PolyElement">PolyElement</span>] | <span title="list">list</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of polynomials or polynomial matrices</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">density</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">matrix_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">PolyElement</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate random polynomial samples</span>

<span class="sd">    Args:</span>
<span class="sd">        num_samples: Number of samples to generate</span>
<span class="sd">        size: If provided, generate matrix of polynomials with given size</span>
<span class="sd">        density: Probability of non-zero entries in matrix</span>
<span class="sd">        matrix_type: Special matrix type (e.g., &#39;unimodular_upper_triangular&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of polynomials or polynomial matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_matrix</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">matrix_type</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample_polynomial</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.total_degree" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">total_degree</span>


<a href="#calt.dataset_generator.sympy.utils.polynomial_sampler.PolynomialSampler.total_degree" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">total_degree</span><span class="p">(</span><span class="n">poly</span><span class="p">:</span> <span class="n">PolyElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute total degree of a polynomial</p>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">total_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">:</span> <span class="n">PolyElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute total degree of a polynomial&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_zero</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">monom</span><span class="p">)</span> <span class="k">for</span> <span class="n">monom</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">monoms</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler"></a>
    <div class="doc doc-contents first">


        <p>Sampler for single polynomial with specific constraints</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_coeff" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">random_coeff</span>


<a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_coeff" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">random_coeff</span><span class="p">(</span><span class="n">field</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">non_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a random coefficient in the given field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code><span title="sympy.polys.domains.domain.Domain">Domain</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The coefficient field (e.g., ZZ, QQ, RR, GF)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>non_zero</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, ensure the coefficient is non-zero</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional parameters for coefficient generation
- min: minimum value (default: -10)
- max: maximum value (default: 10)
- num_bound: bound for numerator and denominator in QQ (default: 10)</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random coefficient in the specified field</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If parameter ranges are invalid or non_zero cannot be satisfied</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="NotImplementedError">NotImplementedError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the field is not supported</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/single_polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">random_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">non_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random coefficient in the given field.</span>

<span class="sd">    Args:</span>
<span class="sd">        field: The coefficient field (e.g., ZZ, QQ, RR, GF)</span>
<span class="sd">        non_zero: If True, ensure the coefficient is non-zero</span>
<span class="sd">        **kwargs: Additional parameters for coefficient generation</span>
<span class="sd">            - min: minimum value (default: -10)</span>
<span class="sd">            - max: maximum value (default: 10)</span>
<span class="sd">            - num_bound: bound for numerator and denominator in QQ (default: 10)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Random coefficient in the specified field</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If parameter ranges are invalid or non_zero cannot be satisfied</span>
<span class="sd">        NotImplementedError: If the field is not supported</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Integer coefficient</span>
    <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="n">ZZ</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;min must be &lt;= max&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">non_zero</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot generate non-zero ZZ with min=0 and max=0&quot;</span><span class="p">)</span>

        <span class="c1"># Define a generator function that returns a random ZZ in [a, b]</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">gen_int</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pick_random_until_nonzero</span><span class="p">(</span><span class="n">gen_int</span><span class="p">,</span> <span class="n">non_zero</span><span class="p">)</span>

    <span class="c1"># Real number coefficient</span>
    <span class="k">elif</span> <span class="n">field</span> <span class="o">==</span> <span class="n">RR</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;min must be &lt;= max&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">non_zero</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot generate non-zero RR with min=0.0 and max=0.0&quot;</span><span class="p">)</span>

        <span class="c1"># Define a generator function that returns a random RR in [a, b]</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">gen_real</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">RR</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pick_random_until_nonzero</span><span class="p">(</span><span class="n">gen_real</span><span class="p">,</span> <span class="n">non_zero</span><span class="p">)</span>

    <span class="c1"># Rational number coefficient</span>
    <span class="k">elif</span> <span class="n">field</span> <span class="o">==</span> <span class="n">QQ</span><span class="p">:</span>
        <span class="n">num_bound</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_bound&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_bound</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_bound must be &gt; 0&quot;</span><span class="p">)</span>

        <span class="c1"># Define a generator function that returns a random QQ with numerator in [-num_bound, num_bound] and denominator in [1, num_bound]</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">gen_rat</span><span class="p">():</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="n">num_bound</span><span class="p">,</span> <span class="n">num_bound</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_bound</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">QQ</span><span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pick_random_until_nonzero</span><span class="p">(</span><span class="n">gen_rat</span><span class="p">,</span> <span class="n">non_zero</span><span class="p">)</span>

    <span class="c1"># Finite field</span>
    <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">is_FiniteField</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">characteristic</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">non_zero</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot generate non-zero finite field coefficient with characteristic 1&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Define a generator function that returns a random field element in GF(p)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">gen_gf</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">field</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pick_random_until_nonzero</span><span class="p">(</span><span class="n">gen_gf</span><span class="p">,</span> <span class="n">non_zero</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Random coefficient generation not implemented for field </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_element" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">random_element</span>


<a href="#calt.dataset_generator.sympy.utils.single_polynomial_sampler.SinglePolynomialSampler.random_element" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">random_element</span><span class="p">(</span>
    <span class="n">R</span><span class="p">:</span> <span class="n">PolyRing</span><span class="p">,</span>
    <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">choose_degree</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">non_zero_coeff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PolyElement</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a random polynomial of at most the specified degree and at most the specified number of terms.</p>
<p>First monomials are chosen uniformly random from the set of all
possible monomials of degree up to the specified degree (inclusive). This means
that it is more likely that a monomial of the specified degree appears than
a monomial of degree (specified degree - 1) because the former class is bigger.</p>
<p>Exactly the specified number of distinct monomials are chosen this way and each one gets
a random coefficient (possibly zero) from the base ring assigned.</p>
<p>The returned polynomial is the sum of this list of terms.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>R</code>
            </td>
            <td>
                  <code><span title="sympy.polys.rings.PolyRing">PolyRing</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polynomial ring</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum degree of the polynomial</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terms</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of terms in the polynomial</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>choose_degree</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to choose degree randomly first</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>non_zero_coeff</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, ensure all coefficients are non-zero</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional parameters for coefficient generation
- min: minimum value (default: -10)
- max: maximum value (default: 10)
- num_bound: bound for numerator and denominator in QQ (default: 10)</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="sympy.polys.rings.PolyElement">PolyElement</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random polynomial in the given ring</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/calt/dataset_generator/sympy/utils/single_polynomial_sampler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">random_element</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">R</span><span class="p">:</span> <span class="n">PolyRing</span><span class="p">,</span>
    <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">terms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">choose_degree</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">non_zero_coeff</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PolyElement</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a random polynomial of at most the specified degree and at most the specified number of terms.</span>

<span class="sd">    First monomials are chosen uniformly random from the set of all</span>
<span class="sd">    possible monomials of degree up to the specified degree (inclusive). This means</span>
<span class="sd">    that it is more likely that a monomial of the specified degree appears than</span>
<span class="sd">    a monomial of degree (specified degree - 1) because the former class is bigger.</span>

<span class="sd">    Exactly the specified number of distinct monomials are chosen this way and each one gets</span>
<span class="sd">    a random coefficient (possibly zero) from the base ring assigned.</span>

<span class="sd">    The returned polynomial is the sum of this list of terms.</span>

<span class="sd">    Args:</span>
<span class="sd">        R: Polynomial ring</span>
<span class="sd">        degree: Maximum degree of the polynomial</span>
<span class="sd">        terms: Number of terms in the polynomial</span>
<span class="sd">        choose_degree: Whether to choose degree randomly first</span>
<span class="sd">        non_zero_coeff: If True, ensure all coefficients are non-zero</span>
<span class="sd">        **kwargs: Additional parameters for coefficient generation</span>
<span class="sd">            - min: minimum value (default: -10)</span>
<span class="sd">            - max: maximum value (default: 10)</span>
<span class="sd">            - num_bound: bound for numerator and denominator in QQ (default: 10)</span>


<span class="sd">    Returns:</span>
<span class="sd">        Random polynomial in the given ring</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">ngens</span>

    <span class="n">counts</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precomp_counts</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">terms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">terms</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;terms must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;degree must be &gt;= 0&quot;</span><span class="p">)</span>

    <span class="c1"># special cases</span>
    <span class="k">if</span> <span class="n">terms</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">if</span> <span class="n">degree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_coeff</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">non_zero</span><span class="o">=</span><span class="n">non_zero_coeff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="c1"># adjust terms</span>
    <span class="k">if</span> <span class="n">terms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>

    <span class="c1"># total is 0. Just return</span>
    <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">elif</span> <span class="n">terms</span> <span class="o">&lt;</span> <span class="n">total</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># we choose random monomials if t &lt; total/2 because then we</span>
        <span class="c1"># expect the algorithm to be faster than generating all</span>
        <span class="c1"># monomials and picking a random index from the list. if t ==</span>
        <span class="c1"># total/2 we expect every second random monomial to be a</span>
        <span class="c1"># double such that our runtime is doubled in the worst case.</span>
        <span class="n">M</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">choose_degree</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">terms</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_monomial_upto_degree_uniform</span><span class="p">(</span>
                    <span class="n">n</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">total</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                    <span class="n">terms</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">terms</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_monomial_upto_degree_class</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                    <span class="n">terms</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">terms</span> <span class="o">&lt;=</span> <span class="n">total</span><span class="p">:</span>
        <span class="c1"># generate a list of all monomials and choose among them</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">choose_degree</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_integer_vectors</span><span class="p">(</span><span class="n">_d</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="k">for</span> <span class="n">_d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="p">[]</span>
            <span class="p">)</span>
            <span class="c1"># we throw away those we don&#39;t need</span>
            <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">terms</span><span class="p">):</span>
                <span class="n">M</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_integer_vectors</span><span class="p">(</span><span class="n">_d</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="k">for</span> <span class="n">_d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">Mbar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
                <span class="c1"># choose degree &#39;d&#39; and monomial &#39;m&#39; at random</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">Mbar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>  <span class="c1"># remove and insert</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c1"># bookkeeping</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Mbar</span><span class="p">]</span>

    <span class="c1"># Generate random coefficients</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_coeff</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">non_zero</span><span class="o">=</span><span class="n">non_zero_coeff</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="c1"># Create the polynomial using from_dict</span>
    <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">C</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>